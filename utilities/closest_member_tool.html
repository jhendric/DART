<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
          "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
<HEAD>
<TITLE>program closest_member_tool</TITLE>
<link rel="stylesheet" type="text/css" href="../doc/html/doc.css">
<link href="../doc/html/dart.ico" rel="shortcut icon" />
</HEAD>
<BODY>
<A NAME="TOP"></A>

<H1>PROGRAM <em class=program>closest_member_tool</em></H1>

<table border=0 summary="" cellpadding=5>
<tr>
    <td valign=middle>
    <img src="../doc/html/Dartboard7.png" alt="DART project logo" height=70 />
    </td>
    <td>
       <P>Jump to <a href="../index.html">DART Documentation Main Index</a><br />
          <small><small>version information for this file: <br />
          <!-- version tag follows, do not edit -->
          $Id$</small></small>
       </P></td>
</tr>
</table>

<A HREF="#Namelist">NAMELIST</A> /
<A HREF="#Modules">MODULES</A> /
<A HREF="#FilesUsed">FILES</A> /
<A HREF="#References">REFERENCES</A> /
<A HREF="#Errors">ERRORS</A> /
<A HREF="#FuturePlans">PLANS</A> /
<A HREF="#Legalese">TERMS OF USE</A>

<H2>Overview</H2>

<P>
Utility program to compare the ensemble mean to a group of ensemble
member restart files.  The program prints out a sorted order of which
members are 'closest' to the mean, where the method used to determine 
'close' is selectable by namelist option.  It also creates a file with
a single number or character string in it, for ease in scripting, which
identifies the closest member.
</P><P>
The ensemble mean is optionally written out from filter by setting a namelist
option in the <a href="../filter/filter.html#Namelist">filter namelist</a>
to output the ensemble mean in restart file format at the end of a run.
The difference is computed point by point across the ensemble members.
There is an option to restrict the computation to just a subset of the
entire state vector by listing one or more generic kinds.
In this case, only state vector items matching one of these kinds
will contribute to the total difference value.
</P><P>
Available methods are:
</P>
<dl>
<dt>1 - simple absolute difference:</dt>
<dd>
The absolute value of the difference between each item in the 
mean vector and the corresponding item in each ensemble member, 
accumulated over the entire state vector.
</dd>
<dt>2 - normalized absolute difference:</dt>
<dd>
The absolute value of the difference between each item in the 
mean vector and the corresponding item in each ensemble member
normalized by the mean value,
accumulated over the entire state vector.
</dd>
<dt>3 - simple RMS difference:</dt>
<dd>
The square root of the accumulated sum of the 
square of the difference between each item in the mean vector 
and the corresponding item in each ensemble member.
</dd>
<dt>4 - normalized RMS difference:</dt>
<dd>
The square root of the accumulated sum of the 
square of the normalized difference between each item in the mean 
vector and the corresponding item in each ensemble member.
</dd>
</dl>
<P>
This program could be used to select one or more ensemble
members to run a free model forecast forward in time after
the assimilation is finished.  Each member is an equally likely
representation of the model state.  Using the ensemble mean
is not usually a good choice since the mean may not have
self-consistent structures in the data.
</P><P>
In addition to printing out data about all members to both
the console and to the dart log file, this program creates
a single output file containing information about the closest member.
If the input restart data is in a single file, the output
file 'closest_restart' contains a single number which is
the ensemble member number.  If the
input restart data is in separate files, the output file
contains the full filename of the closest member, e.g.
'filter_restart.0004' if member 4 is closest.  For scripting
the contents of this file can be used to copy the corresponding
member data and convert it to the model input format for a 
free forecast, for example.
</P>
<P>
Namelist interface
<A HREF="#Namelist"><em class=code>&amp;closest_member_tool_nml</em> </A>
is read from file <em class=file>input.nml</em>.
</P>

<!--==================================================================-->
<!--=================== DESCRIPTION OF A NAMELIST ====================-->
<!--==================================================================-->

<A NAME="Namelist"></A>
<HR>
<H2>NAMELIST</H2>
<P>We adhere to the F90 standard of starting a namelist with an ampersand
'&amp;' and terminating with a slash '/' for all our namelist input.
</P>
<div class=namelist>
<pre>
<em class=call>namelist / closest_member_tool_nml / </em> 
   input_file_name, output_file_name, 
   ens_size, single_restart_file_in, difference_method,
   use_only_kinds
</pre>
</div>

<div class=indent1>
<!-- Description -->

<P>
The namelist sets the behavior of this tool.
<br>
<br>
This namelist is read in a file called <em class=file>input.nml</em>
</P>

<TABLE border=0 cellpadding=10 width=100%>
<TR><TH align=left>Contents    </TH>
    <TH align=left>Type        </TH>
    <TH align=left>Description </TH></TR>
<TR><!--contents--><TD valign=top>input_file_name</TD>
    <!--  type  --><TD valign=top>character</TD>
    <!--descript--><TD valign=top>File containing the DART restart data.  If
                  'single_restart_file_in' is .true., this is the exact filename.
                  If 'single_restart_file_in' is .false. this is the base name and
                  '.NNNN' will be appended to each name before being opened.
                  Default "filter_restart"</TD></TR>
<TR><!--contents--><TD valign=top>output_file_name</TD>
    <!--  type  --><TD valign=top>character</TD>
    <!--descript--><TD valign=top>File created by this program with either
                  the ensemble number or full restart filename for the closest member.
                  If 'single_restart_file_in' is .true., the file contains the ensemble number.
                  If 'single_restart_file_in' is .false. the file contains the base name and
                  '.NNNN' appended for the closest member.
                  Default "closest_restart"</TD></TR>
<TR><!--contents--><TD valign=top>ens_size</TD>
    <!--  type  --><TD valign=top>integer</TD>
    <!--descript--><TD valign=top>Total number of ensemble members.
                  Default 20</TD></TR>
<TR><!--contents--><TD valign=top>single_restart_file_in</TD>
    <!--  type  --><TD valign=top>logical</TD>
    <!--descript--><TD valign=top>Whether the input filename contains a single ensemble 
                  member per file or multiple members concatinated in the same file.
                  Default .true.</TD></TR>
<TR><!--contents--><TD valign=top>difference_method</TD>
    <!--  type  --><TD valign=top>integer</TD>
    <!--descript--><TD valign=top>Select which method is used
                  to compute 'distance' from mean:
<table>
<tr><td>1 &nbsp;</td><td>simple absolute difference</td></tr>
<tr><td>2</td><td>normalized absolute difference</td></tr>
<tr><td>3</td><td>simple RMS difference</td></tr>
<tr><td>4</td><td>normalized RMS difference</td></tr>
</table>

                  Default 4</TD></TR>
<TR><!--contents--><TD valign=top>use_only_kinds</TD>
    <!--  type  --><TD valign=top>character(len=32)</TD>
    <!--descript--><TD valign=top>If unspecified, all items in the state vector
                  contribute to the total difference.  If one or more kinds
                  are listed here, only items in the state vector of these kinds
                  contribute to the total difference.  These are the generic kinds,
                  such as KIND_TEMPERATURE, KIND_U_WIND_COMPONENT, KIND_DENSITY, etc.
                  and not specific types like RADIOSONDE_TEMPERATURE.  Consult the 
                  model interface code to determine which possible kinds are returned by the
          <a href="../models/model_mod.html#get_state_meta_data">get_state_meta_data()</a> routine.
                  Default ''.</TD></TR>
</TABLE>

</div>
<br>

<!--==================================================================-->

<A NAME="Modules"></A>
<HR>
<H2>MODULES USED</H2>
<PRE>
types_mod
time_manager_mod
utilities_mod
sort_mod
assim_model_mod
mpi_utilities_mod
</PRE>

<!--==================================================================-->
<!-- Describe the Files Used by this module.                          -->
<!--==================================================================-->

<A NAME="FilesUsed"></A>
<HR>
<H2>FILES</H2>
<UL><LI>inputfile (filter_restart, filter_restart.mean)
    <LI>closest_member_tool.nml 
</UL>

<!--==================================================================-->
<!-- Cite references, if need be.                                     -->
<!--==================================================================-->

<A NAME="References"></A>
<HR>
<H2>REFERENCES</H2>
<ul>
<li> none </li>
</ul>

<!--==================================================================-->
<!-- Describe all the error conditions and codes.                     -->
<!--==================================================================-->

<A NAME="Errors"></A>
<HR>
<H2>ERROR CODES and CONDITIONS</H2>
<div class=errors>
<TABLE border=1 cellspacing=1 cellpadding=10 width=100%>
<TR><TH>Routine</TH><TH>Message</TH><TH>Comment</TH></TR>

<TR><!-- routine --><TD VALIGN=top>closest_member_tool</TD>
    <!-- message --><TD VALIGN=top>Invalid method number</TD>
    <!-- comment --><TD VALIGN=top>Values 1-4 are supported</TD></TR>

</TABLE>
</div>

<H2>KNOWN BUGS</H2>
<P>
none
</P>

<!--==================================================================-->
<!-- Describe Future Plans.                                           -->
<!--==================================================================-->

<A NAME="FuturePlans"></A>
<HR>
<H2>FUTURE PLANS</H2>
<P>
none
</P>

<!--==================================================================-->
<!-- Legalese & Metadata                                              -->
<!--==================================================================-->

<A NAME="Legalese"></A>
<HR>
<H2>Terms of Use</H2>

<P>
DART software - Copyright 2004 - 2011 UCAR.<br>
This open source software is provided by UCAR, "as is",<br>
without charge, subject to all terms of use at<br>
<a href="http://www.image.ucar.edu/DAReS/DART/DART_download">
http://www.image.ucar.edu/DAReS/DART/DART_download</a>
</P>

<TABLE border=0 cellpadding=0 width=100% summary="">
<TR><TD valign=top>Contact:       </TD><TD> DART core group   </TD></TR>
<TR><TD valign=top>Revision:      </TD><TD> $Revision$ </TD></TR>
<TR><TD valign=top>Source:        </TD><TD> $URL$ </TD></TR>
<TR><TD valign=top>Change Date:   </TD><TD> $Date$ </TD></TR>
<TR><TD valign=top>Change&nbsp;history:&nbsp;</TD><TD> try "svn&nbsp;log" or "svn&nbsp;diff" </TD></TR>
</TABLE>

<!--==================================================================-->

</BODY>
</HTML>
