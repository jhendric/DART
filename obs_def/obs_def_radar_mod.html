<!--
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!                                                                       !!
!!                   GNU General Public License                          !!
!!                                                                       !!
!! This file is part of the Data Assimilation Research Testbed (DART).   !!
!!                                                                       !!
!! DART is free software; you can redistribute it and/or modify          !!
!! it and are expected to follow the terms of the GNU General Public     !!
!! License as published by the Free Software Foundation.                 !!
!!                                                                       !!
!! DART is distributed in the hope that it will be useful,               !!
!! but WITHOUT ANY WARRANTY; without even the implied warranty of        !!
!! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         !!
!! GNU General Public License for more details.                          !!
!!                                                                       !!
!! You should have received a copy of the GNU General Public License     !!
!! along with DART; if not, write to:                                    !!
!!          Free Software Foundation, Inc.                               !!
!!          59 Temple Place, Suite 330                                   !!
!!          Boston, MA  02111-1307  USA                                  !!
!! or see:                                                               !!
!!          http://www.gnu.org/licenses/gpl.txt                          !!
!!                                                                       !!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-->

<HTML>
<TITLE>module obs_def_radar_mod</TITLE>
<link rel=stylesheet type=text/css href=../doc/html/doc.css>
<BODY>

<DIV ALIGN=CENTER>
<A HREF="#Interface">INTERFACE</A> /
<A HREF="#PublicEntities">PUBLIC COMPONENTS</A> /
<A HREF="#FilesUsed">FILES</A> /
<A HREF="#References">REFERENCES</A> /
<A HREF="#Errors">ERRORS</A> /
<A HREF="#KnownBugs">BUGS</A> /
<A HREF="#FuturePlans">PLANS</A> /
<A HREF="#PrivateComponents">PRIVATE COMPONENTS</A>
</DIV>

<!--==================================================================-->

<H1>MODULE obs_def_radar_mod</H1>
<A NAME="HEADER"></A>
<TABLE summary="">
   <TR><TD>Contact:       </TD><TD> Jeff Anderson                </TD></TR>
   <TR><TD>Reviewers:     </TD><TD> &nbsp;                       </TD></TR>
   <TR><TD>Revision:      </TD><TD> $Revision$             </TD></TR>
   <TR><TD>Release Name:  </TD><TD> $Name$                       </TD></TR>
   <TR><TD>Change Date:   </TD><TD> $Date$ </TD></TR>
   <TR><TD>Change history:</TD><TD> see CVS log                  </TD></TR>
</TABLE>

<!--==================================================================-->

<A NAME="OVERVIEW"></A>
<HR>
<H2>OVERVIEW</H2>
Provides subroutines to calculate radar radial velocity and reflectivity from model variables.
<P>
<BR>

<!--==================================================================-->

<A NAME="OTHER MODULES USED"></A>
<BR><HR><BR>
<H2>OTHER MODULES USED</H2>
<PRE>
types_mod
utilities_mod
location_mod (most likely threed_sphere)
assim_model_mod
obs_kind_mod
</PRE>

<!--==================================================================-->
<!--Note to authors. The first row of the table is different.         -->

<A NAME="Interface"></A>
<BR><HR><BR>
<H2>PUBLIC INTERFACE</H2>

<TABLE>
<TR><TD><em class=call>use obs_def_radar_mod, only : </em></TD>
                   <TD><A HREF="#yyyroutine1">write_rad_vel</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine2">read_rad_vel</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine3">set_rad_vel</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine4">interactive_rad_vel</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine5">get_expected_rad_vel</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine6">get_expected_rad_ref</A></TD></TR>
</TABLE>

<BR>

<!--==================================================================-->
<!-- Declare all public entities ...                                  -->
<!-- duplicate public routines template as many times as necessary    -->
<!-- make sure you replace all yyyroutine?? strings                   -->
<!--==================================================================-->

<A NAME="PublicEntities"></A>
<BR><HR><BR>
<H2>PUBLIC COMPONENTS</H2>
<BR>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->

<A NAME="yyyroutine1"></A>
 <P></P><HR><P></P>
 <div class=routine>
 <em class=call> call write_rad_vel(key, ifile<em class=optionalcode>[, fform]</em>) </em>
 <pre>
 integer,                    intent(in) :: <em class=code>key</em>
 integer,                    intent(in) :: <em class=code>ifile</em>
 character(len=*), optional, intent(in) :: <em class=optionalcode>fform</em>
</pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Writes the obs definition part required for radial velocity.
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>key&nbsp; &nbsp; </em></TD>
     <TD>Unique identifier associated to this radial velocity observation</TD></TR>
 <TR><TD valign=top><em class=code>ifile&nbsp; &nbsp; </em></TD>
     <TD>File unit open to output file</TD></TR>
 <TR><TD valign=top><em class=optionalcode>fform&nbsp; &nbsp; </em></TD>
     <TD>File format specifier: FORMATTED or UNFORMATTED; default FORMATTED</TD>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->
<A NAME="yyyroutine2"></A>
 <P></P><HR><P></P>
 <div class=routine>
 <em class=call> call read_rad_vel(key, ifile<em class=optionalcode>[, fform]</em>) </em>
 <pre>
 integer,                    intent(in) :: <em class=code>key</em>
 integer,                    intent(in) :: <em class=code>ifile</em>
 character(len=*), optional, intent(in) :: <em class=optionalcode>fform</em>
</pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Read companion of write_rad_vel.
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>key&nbsp; &nbsp; </em></TD>
     <TD>Unique identifier associated to this radial velocity observation</TD></TR>
 <TR><TD valign=top><em class=code>ifile&nbsp; &nbsp; </em></TD>
     <TD>File unit open to output file</TD></TR>
 <TR><TD valign=top><em class=optionalcode>fform&nbsp; &nbsp; </em></TD>
     <TD>File format specifier: FORMATTED or UNFORMATTED; default FORMATTED</TD>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->
<A NAME="yyyroutine3"></A>
 <P></P><HR><P></P>
 <div class=routine>
 <em class=call> call set_rad_vel(key, location, orientation) </em>
 <pre>
 integer,             intent(in) :: <em class=code>key</em>
 type(location_type), intent(in) :: <em class=code>location</em>
 real(r8),            intent(in) :: <em class=code>orientation</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Set the radar location and the orientation of the radar beam at the observation location in the private arrays of the module.
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>key&nbsp; &nbsp; </em></TD>
     <TD>Unique identifier associated to this radial velocity observation</TD></TR>
 <TR><TD valign=top><em class=code>location&nbsp; &nbsp; </em></TD>
     <TD>Radar location</TD></TR>
 <TR><TD valign=top><em class=code>orientation&nbsp; &nbsp; </em></TD>
     <TD>Orientation of the radar beam at the observation location</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->
<A NAME="yyyroutine4"></A>
 <P></P><HR><P></P>
 <div class=routine>
 <em class=call> call interactive_rad_vel(key) </em>
 <pre>
 integer, intent(in) :: <em class=code>key</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Initializes the specialized part of a radial velocity observation from information provided interactively by the user. Not yet implemented.
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>key&nbsp; &nbsp; </em></TD>
     <TD>Unique identifier associated to this radial velocity observation</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->
<A NAME="yyyroutine5"></A>
 <P></P><HR><P></P>
 <div class=routine>
 <em class=call> call get_expected_rad_vel(state_vector, location, key, vr, istatus) </em>
 <pre>
 real(r8),            intent(in)  :: <em class=code>state_vector(:)</em>
 type(location_type), intent(in)  :: <em class=code>location</em>
 integer,             intent(in)  :: <em class=code>key</em>
 real(r8),            intent(out) :: <em class=code>vr</em>
 integer,             intent(out) :: <em class=code>istatus</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Calculates the radial velocity (m/s).
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>state_vector&nbsp; &nbsp; </em></TD>
     <TD>A one dimensional representation of the model state vector</TD></TR>
 <TR><TD valign=top><em class=code>location&nbsp; &nbsp; </em></TD>
     <TD>Location of this obs</TD></TR>
 <TR><TD valign=top><em class=code>key&nbsp; &nbsp; </em></TD>
     <TD>Unique identifier associated to this radial velocity observation</TD></TR>
 <TR><TD valign=top><em class=code>vr&nbsp; &nbsp; </em></TD>
     <TD>The returned radial velocity value</TD></TR>
 <TR><TD valign=top><em class=code>istatus&nbsp; &nbsp; </em></TD>
     <TD>Returned integer describing problems with applying
                 forward operator</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->
<A NAME="yyyroutine6"></A>
 <P></P><HR><P></P>
 <div class=routine>
 <em class=call> call get_expected_rad_ref(state_vector, location, ref, istatus) </em>
 <pre>
 real(r8),            intent(in)  :: <em class=code>state_vector(:)</em>
 type(location_type), intent(in)  :: <em class=code>location</em>
 real(r8),            intent(out) :: <em class=code>ref</em>
 integer,             intent(out) :: <em class=code>istatus</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Calculates the radar reflectivity (dBZ), where Z (mm^6 m^-3).
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>state_vector&nbsp; &nbsp; </em></TD>
     <TD>A one dimensional representation of the model state vector</TD></TR>
 <TR><TD valign=top><em class=code>location&nbsp; &nbsp; </em></TD>
     <TD>Location of this obs</TD></TR>
 <TR><TD valign=top><em class=code>vr&nbsp; &nbsp; </em></TD>
     <TD>The returned radar reflectivity value</TD></TR>
 <TR><TD valign=top><em class=code>istatus&nbsp; &nbsp; </em></TD>
     <TD>Returned integer describing problems with applying
                 forward operator</TD></TR>
 </TABLE>
 <BR>

<!--==================================================================-->

<!--==================================================================-->
<!-- Declare all private entities.                                    -->
<!--==================================================================-->

<A NAME="PrivateComponents"></A>
<BR><HR><BR>
<H2>PRIVATE COMPONENTS</H2>

<TABLE>
<TR><TD>&nbsp;</TD><TD><A HREF="#get_reflectivity">get_reflectivity</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#write_orientation">write_orientation</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#read_orientation">read_orientation</A></TD></TR>
</TABLE>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->
<A NAME="get_reflectivity"></A>
 <P></P><HR><P></P>
 <div class=routine>
 <em class=call> call get_reflectivity(qr, qg, qs, rho, temp, ref) </em>
 <pre>
 real(r8), intent(in)  :: <em class=code>qr</em>
 real(r8), intent(in)  :: <em class=code>qg</em>
 real(r8), intent(in)  :: <em class=code>qs</em>
 real(r8), intent(in)  :: <em class=code>rho</em>
 real(r8), intent(in)  :: <em class=code>temp</em>
 real(r8), intent(out) :: <em class=code>ref</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Calculates the radar reflectivity Z (mm^6 m^-3).
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>qr&nbsp; &nbsp; </em></TD>
     <TD>Rain water content (kg kg^-1)</TD></TR>
 <TR><TD valign=top><em class=code>qg&nbsp; &nbsp; </em></TD>
     <TD>Graupel/hail content (kg kg^-1)</TD></TR>
 <TR><TD valign=top><em class=code>qs&nbsp; &nbsp; </em></TD>
     <TD>Snow content (kg kg^-1)</TD></TR>
 <TR><TD valign=top><em class=code>rho&nbsp; &nbsp; </em></TD>
     <TD>Air density (kg m^-3)</TD></TR>
 <TR><TD valign=top><em class=code>temp&nbsp; &nbsp; </em></TD>
     <TD>Air temperature (K)</TD></TR>
 <TR><TD valign=top><em class=code>ref&nbsp; &nbsp; </em></TD>
     <TD>The returned radar reflectivity value</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->

<A NAME="write_orientation"></A>
 <P></P><HR><P></P>
 <div class=routine>
 <em class=call> call write_orientation(ifile, orientation<em class=optionalcode>[, fform]</em>) </em>
 <pre>
 integer,                    intent(in) :: <em class=code>ifile</em>
 real(r8),                   intent(in) :: <em class=code>orientation(3)</em>
 character(len=*), optional, intent(in) :: <em class=optionalcode>fform</em>
</pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Writes the orientation required for radial velocity.
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>ifile&nbsp; &nbsp; </em></TD>
     <TD>File unit open to output file</TD></TR>
 <TR><TD valign=top><em class=code>orientation&nbsp; &nbsp; </em></TD>
     <TD>Three components of the velocity orientation</TD></TR>
 <TR><TD valign=top><em class=optionalcode>fform&nbsp; &nbsp; </em></TD>
     <TD>File format specifier: FORMATTED or UNFORMATTED; default FORMATTED</TD>
 </TABLE>
 <BR>

<!--===================== DESCRIPTION OF FUNCTION ====================-->

<A NAME="read_orientation"></A>
<P></P><HR><P></P>
<div class=routine>
<em class=call> orientation = read_orientation(ifile<em class=optionalcode>[, fform]</em>)</em>
<pre>
 integer,                    intent(in) :: <em class=code>ifile</em>
 character(len=*), optional, intent(in) :: <em class=optionalcode>fform</em>
</pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Reads orientation from file that was written by write_orientation.
</P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>ifile&nbsp; &nbsp; </em></TD>
     <TD>File unit open to output file</TD></TR>
 <TR><TD valign=top><em class=optionalcode>fform&nbsp; &nbsp; </em></TD>
     <TD>File format specifier: FORMATTED or UNFORMATTED; default FORMATTED</TD>
 </TABLE>
 <BR>


<!--==================================================================-->
<!-- Describe the Files Used by this module.                          -->
<!--==================================================================-->
</P>
<A NAME="FilesUsed"></A>
<BR><HR><BR>
<H2>FILES</H2>
<UL><LI>NONE
</UL>

<!--==================================================================-->
<!-- Cite references, if need be.                                     -->
<!--==================================================================-->

<A NAME="References"></A>
<BR><HR><BR>
<H2>REFERENCES</H2>
<UL>
<LI> Battan, L. J., 1973: <i>Radar Observation of the Atmosphere.</i> Univ. of Chicago Press, 324 pp.
<LI> Doviak, R. J., and D. S. Zrnic, 1993: <i> Doppler Radar and Weather Observations.</i> Academic Press, 562 pp.
<LI> Ferrier, B. S., 1994: A double-moment multiple-phase four-class bulk ice scheme. Part I: Description. <i>J. Atmos. Sci.</i>, <b>51</b>, 249-280.
<LI> Lin, Y.-L., Farley R. D., and H. D. Orville, 1983: Bulk parameterization of the snow field in a cloud model. <i>J. Climate Appl. Meteor.</i>, <b>22</b>, 1065-1092.
<LI> Smith, P. L. Jr., 1984: Equivalent radar reflectivity factors for snow and ice particles. <i>J. Climate Appl. Meteor.</i>, 23, 1258-1260.
<LI> Smith, P. L. Jr., Myers C. G., and H. D. Orville, 1975: Radar reflectivity factor calculations in numerical cloud models using bulk parameterization of precipitation. <i>J. Appl. Meteor.</i>, <b>14</b>, 1156-1165.
</UL>

<!--==================================================================-->
<!-- Describe all the error conditions and codes.                     -->
<!-- Putting a <BR> after the synopsis creates a nice effect.         -->
<!--==================================================================-->

<A NAME="Errors"></A>
<HR>
<H2>ERROR CODES and CONDITIONS</H2>
<div class="errors">
<TABLE border=1 cellspacing=1 cellpadding=10 width=100%>
<TR><TH>Routine</TH><TH>Message</TH><TH>Comment</TH></TR>

<TR><!-- routine --><TD VALIGN=top>read_rad_vel</TD>
    <!-- message --><TD VALIGN=top>Expected location header "platform" in input file</TD>
    <!-- comment --><TD VALIGN=top>The format of the input file is not consistent.</TD>
</TR>
<TR><!-- routine --><TD VALIGN=top>read_rad_vel<BR>
                                   set_rad_vel</TD>
    <!-- message --><TD VALIGN=top>'key (',key,') exceed max_rad_vel_obs (',max_rad_vel_obs,')'</TD>
    <!-- comment --><TD VALIGN=top>The number of radial velocity observations exceeds the array size set in the module. The module has to be edited and recompiled.</TD>
</TR>
<TR><!-- routine --><TD VALIGN=top>read_orientation</TD>
    <!-- message --><TD VALIGN=top>Expected orientation header "dir3d" in input file</TD>
    <!-- comment --><TD VALIGN=top>The format of the input file is not consistent.</TD>
</TR>
</TABLE>
</div>

<!--==================================================================-->
<!-- Describe the bugs.                                               -->
<!--==================================================================-->

<A NAME="KnownBugs"></A>
<BR><HR><BR>
<H2>KNOWN BUGS</H2>
<P>
</P>

<!--==================================================================-->
<!-- Describe Future Plans.                                            -->
<!--==================================================================-->

<A NAME="FuturePlans"></A>
<BR><HR><BR>
<H2>FUTURE PLANS</H2>
<P>
</P>

<!--==================================================================-->

<HR>
</BODY>
</HTML>
