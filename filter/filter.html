<!--
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!                                                                       !!
!!                   GNU General Public License                          !!
!!                                                                       !!
!! This file is part of the Data Assimilation Research Testbed (DART).   !!
!!                                                                       !!
!! DART is free software; you can redistribute it and/or modify          !!
!! it and are expected to follow the terms of the GNU General Public     !!
!! License as published by the Free Software Foundation.                 !!
!!                                                                       !!
!! DART is distributed in the hope that it will be useful,               !!
!! but WITHOUT ANY WARRANTY; without even the implied warranty of        !!
!! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         !!
!! GNU General Public License for more details.                          !!
!!                                                                       !!
!! You should have received a copy of the GNU General Public License     !!
!! along with DART; if not, write to:                                    !!
!!          Free Software Foundation, Inc.                               !!
!!          59 Temple Place, Suite 330                                   !!
!!          Boston, MA  02111-1307  USA                                  !!
!! or see:                                                               !!
!!          http://www.gnu.org/licenses/gpl.txt                          !!
!!                                                                       !!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-->

<HTML>
<TITLE>module xxxxxxx</TITLE>
<link rel=stylesheet type=text/css href=doc.css>
<BODY>

<DIV ALIGN=CENTER>
<A HREF="#Interface">INTERFACE</A> / 
<A HREF="#PublicEntities">PUBLIC COMPONENTS</A> / 
<A HREF="#Namelist">NAMELIST</A> / 
<A HREF="#FilesUsed">FILES</A> /
<A HREF="#References">REFERENCES</A> /
<A HREF="#Errors">ERRORS</A> /
<A HREF="#KnownBugs">BUGS</A> /
<A HREF="#FuturePlans">PLANS</A> /
<A HREF="#PrivateComponents">PRIVATE COMPONENTS</A>
</DIV>

<!--==================================================================-->

<H1>PROGRAM filter</H1>
<A NAME="HEADER"></A>
<TABLE summary="">
   <TR><TD>Contact:       </TD><TD> Jeff Anderson                </TD></TR>
   <TR><TD>Reviewers:     </TD><TD> &nbsp;                       </TD></TR>
   <TR><TD>Revision:      </TD><TD> $Revision$             </TD></TR>
   <TR><TD>Change Date:   </TD><TD> $Date$ </TD></TR>
   <TR><TD>Change history:</TD><TD> see CVS log </TD></TR>
</TABLE>

<!--==================================================================-->

<A NAME="OVERVIEW"></A>
<HR>
<H2>OVERVIEW</H2>

<P>
   Main program for driving ensemble filter assimilations. This program 
   provides a number of options that are driven from its namelist. The
   number of assimilation steps to be done are controlled by the input
   observation sequence and by the time-stepping capabilities of the model
   being used in the assimilation.
</P>

<!--==================================================================-->

<A NAME="OTHER MODULES USED"></A>
<BR><HR><BR>
<H2>OTHER MODULES USED</H2>
<PRE>
types_mod
obs_sequence_mod
time_manager_mod
utilities_mod
assim_model_mod
random_seq_mod
assim_tools_mod
cov_cutoff_mod
location_mod
reg_factor_mod
sort_mod
</PRE>


<!--==================================================================-->
<!--=================== DESCRIPTION OF A NAMELIST  ===================-->

<A NAME="Namelist"></A>
<BR><HR><BR>
<H2>NAMELIST</H2>
<P>We adhere to the F90 standard of starting a namelist with an ampersand 
'&' and terminating with a slash '/'.
<div class=namelist><pre>
<em class=call>namelist / filter_nml / </em> &
      async, ens_size, cutoff, cov_inflate, start_from_restart, output_restart &
      obs_sequence_file_name, restart_in_file_name, restart_out_file_name, &
      init_time_days, init_time_seconds, output_state_ens_mean, &
      output_state_ens_spread, num_output_ens_members, output_interval, &
      num_groups, confidence_slope, output_obs_diagnostics, get_mean_reg, get_median_reg
</pre></div>

<H3 class=indent1>Discussion</H3>

<P>This namelist is read in a file called <em class=file>input.nml</em>
</P>

<TABLE border=0 cellpadding=3 width=100%>
<TR><TH align=left>Contents    </TH>
    <TH align=left>Type        </TH>
    <TH align=left>Description </TH></TR>
<TR><!--contents--><TD valign=top>async             </TD>
    <!--  type  --><TD valign=top>integer <em class="unit"></em></TD>
    <!--descript--><TD>Controls whether models are advanced via a subroutine call or
                       by writing initial condition files for ensemble members to 
                       disk and having shellscript advance the model. Option: 0 = advance 
                       by subroutine; 1 = shell advance using shell script piped to
                       filter; 2 = advance by F90 calls to shell to advance model. Default
                       value is 0. </TD></TR>
<TR><!--contents--><TD valign=top> ens_size       </TD>
    <!--  type  --><TD>real(r8)                         </TD>
    <!--descript--><TD>Number of ensemble members to be integrated. 
                       Default is 20.                      </TD></TR>  
<TR><!--contents--><TD valign=top>cutoff            </TD>
    <!--  type  --><TD>real(r8)                        </TD>
    <!--descript--><TD>Cutoff controls a distance dependent weight that modulates
                       the impact of an observation on a state variable. The units depend
                       both on the location module being used and on the covariance cutoff
                       module options selected. Default is 0.2.                </TD></TR>
<TR><!--contents--><TD valign=top>cov_inflate         </TD>
    <!--  type  --><TD>real(r8)                        </TD>
    <!--descript--><TD>Covariance inflation factor applied to prior estimate before each
                       assimilation step. Default is 1.0 (no inflation).                 </TD></TR> 
<TR><!--contents--><TD valign=top>start_from_restart    </TD>
    <!--  type  --><TD>logical                        </TD>
    <!--descript--><TD>Should initial ensemble states come from a restart file. 
                       Default is .false.                      </TD></TR>
<TR><!--contents--><TD valign=top>output_restart            </TD>
    <!--  type  --><TD>logical                        </TD>
    <!--descript--><TD>Should a restart file be written out for all ensemble 
                       members? Default is .false.                      </TD></TR>
<TR><!--contents--><TD valign=top>obs_sequence_file_name          </TD>
    <!--  type  --><TD>character(len = 129)            </TD>
    <!--descript--><TD>File name that contains and observation sequence file.
                       Default is 'obs_seq.in'.        </TD></TR>
<TR><!--contents--><TD valign=top>restart_in_file_name         </TD>
    <!--  type  --><TD>character(len=129)               </TD>
    <!--descript--><TD>File name for a file containing restart state for all 
                       ensemble members. Default is 'filter_ics'. </TD></TR>
<TR><!--contents--><TD valign=top>restart_out_file_name              </TD>
    <!--  type  --><TD>character(len = 129)                 </TD>
    <!--descript--><TD>File name for output restart file. 
                       Default is 'filter_restart'.             </TD></TR>
<TR><!--contents--><TD valign=top>init_time_days               </TD>
    <!--  type  --><TD>integer                         </TD>
    <!--descript--><TD>Initial time of model (time is in days and seconds; see
                       time_manager. If init_time_days and init_time_seconds are 
                       less than 0, the initial time comes from the time in 
                       the restart file. Default value is 0. </TD></TR> 
<TR><!--contents--><TD valign=top>init_time_seconds            </TD>
    <!--  type  --><TD>integer                         </TD>
    <!--descript--><TD>Initial time of model in seconds. Default is 0.  </TD></TR>
<TR><!--contents--><TD valign=top>output_state_ens_mean            </TD>
    <!--  type  --><TD>logical                         </TD>
    <!--descript--><TD>Output ensemble mean in state diagnostic files. </TD></TR>
<TR><!--contents--><TD valign=top>num_output_ens_members            </TD>
    <!--  type  --><TD>integer                         </TD>
    <!--descript--><TD>This number of ensemble members is output to the
                       state diagnostics file. If this is less than the total
                       number of ensemble members the first subset is output. 
                       Default is 0.</TD></TR>
<TR><!--contents--><TD valign=top>output_interval            </TD>
    <!--  type  --><TD>integer                         </TD>
    <!--descript--><TD>The frequency with which output diagnostics are written.
                       Default value is 1. </TD></TR>
<TR><!--contents--><TD valign=top>num_groups            </TD>
    <!--  type  --><TD>integer                         </TD>
    <!--descript--><TD>Number of groups for hierarchical group filter. Should 
                       be a divisor of the ensemble size. Default is 1. </TD></TR>
<TR><!--contents--><TD valign=top>confidence_slope            </TD>
    <!--  type  --><TD>real(r8)                        </TD>
    <!--descript--><TD>Controls strength of bias correction algorithm. See
                       assim_tools module. Default is 0 (no correction). </TD></TR>
<TR><!--contents--><TD valign=top>output_obs_diagnostics            </TD>
    <!--  type  --><TD>logical                         </TD>
    <!--descript--><TD>Should an observation space diagnostics file be output.
                       Default value is .false. </TD></TR>
<TR><!--contents--><TD valign=top>get_mean_reg            </TD>
    <!--  type  --><TD>logical                         </TD>
    <!--descript--><TD>Compute time mean regressions from group filter and output
                       to file. Only works with group filter. Default is .false. </TD></TR>
<TR><!--contents--><TD valign=top>get_median_reg            </TD>
    <!--  type  --><TD>logical                         </TD>
    <!--descript--><TD>Compute time median regression from group filter and output
                       to file. Only works with group filter. Default is .false. </TD></TR>
</TABLE>

<!--==================================================================-->
<!-- Describe the Files Used by this module.                          -->
<!--==================================================================-->

<A NAME="FilesUsed"></A>
<BR><HR><BR>
<H2>FILES</H2>
<UL><LI>observation sequence input file
    <LI>state restart file
    <LI>output state space diagnostics file
    <LI>ouptut observation space diagnostic file
    <LI>output time mean regression file
    <LI>output time median regression file
</UL>

<!--==================================================================-->
<!-- Cite references, if need be.                                     -->
<!--==================================================================-->

<A NAME="References"></A>
<BR><HR><BR>
<H2>REFERENCES</H2>

<!--==================================================================-->
<!-- Describe all the error conditions and codes.                     -->
<!-- Putting a <BR> after the synopsis creates a nice effect.         -->
<!--==================================================================-->

<A NAME="Errors"></A>
<HR>
<H2>ERROR CODES and CONDITIONS</H2>
<div class="errors">
<TABLE border=1 cellspacing=1 cellpadding=10 width=100%>
<TR><TH>Routine</TH><TH>Message</TH><TH>Comment</TH></TR>

<TR><!-- routine --><TD VALIGN=top>filter</TD>
    <!-- message --><TD VALIGN=top>output metadata in filter needs ensemble size < 10000</TD>
    <!-- comment --><TD VALIGN=top>Ensemble sizes greater than require modifications to output ensemble code.</TD>
</TR>

</TABLE>
</div>

<!--==================================================================-->
<!-- Describe the bugs.                                               -->
<!--==================================================================-->

<A NAME="KnownBugs"></A>
<BR><HR><BR>
<H2>KNOWN BUGS</H2>
<P>
</P>

<!--==================================================================-->
<!-- Descibe Future Plans.                                            -->
<!--==================================================================-->

<A NAME="FuturePlans"></A>
<BR><HR><BR>
<H2>FUTURE PLANS</H2>
<P>
   The filter will be modified to support parallel implementation and
   use of observations that can only be computed from the state prior
   once at the start of the assimilation. A new observation sequence
   module is also under development to support this and clean up the
   use of observations.
</P>

<!--==================================================================-->
<!-- Have not fleshed out this part yet ... ha ha ha                  -->
<!--==================================================================-->


<H3 class=indent1>Discussion</H3>

<!--==================================================================-->

<HR>
</BODY>
</HTML>
