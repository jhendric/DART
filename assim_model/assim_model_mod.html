<!--
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!                                                                       !!
!!                   GNU General Public License                          !!
!!                                                                       !!
!! This file is part of the Data Assimilation Research Testbed (DART).   !!
!!                                                                       !!
!! DART is free software; you can redistribute it and/or modify          !!
!! it and are expected to follow the terms of the GNU General Public     !!
!! License as published by the Free Software Foundation.                 !!
!!                                                                       !!
!! DART is distributed in the hope that it will be useful,               !!
!! but WITHOUT ANY WARRANTY; without even the implied warranty of        !!
!! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         !!
!! GNU General Public License for more details.                          !!
!!                                                                       !!
!! You should have received a copy of the GNU General Public License     !!
!! along with DART; if not, write to:                                    !!
!!          Free Software Foundation, Inc.                               !!
!!          59 Temple Place, Suite 330                                   !!
!!          Boston, MA  02111-1307  USA                                  !!
!! or see:                                                               !!
!!          http://www.gnu.org/licenses/gpl.txt                          !!
!!                                                                       !!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-->

<HTML>
<TITLE>module xxxxxxx</TITLE>
<link rel=stylesheet type=text/css href=doc.css>
<BODY>

<DIV ALIGN=CENTER>
<A HREF="#Interface">INTERFACE</A> / 
<A HREF="#PublicEntities">PUBLIC COMPONENTS</A> / 
<A HREF="#Namelist">NAMELIST</A> / 
<A HREF="#FilesUsed">FILES</A> /
<A HREF="#References">REFERENCES</A> /
<A HREF="#Errors">ERRORS</A> /
<A HREF="#KnownBugs">BUGS</A> /
<A HREF="#FuturePlans">PLANS</A> /
<A HREF="#PrivateComponents">PRIVATE COMPONENTS</A>
</DIV>

<!--==================================================================-->

<H1>MODULE assim_model_mod</H1>
<A NAME="HEADER"></A>
<TABLE summary="">
   <TR><TD>Contact:       </TD><TD> Jeff Anderson                </TD></TR>
   <TR><TD>Reviewers:     </TD><TD> &nbsp;                       </TD></TR>
   <TR><TD>Revision:      </TD><TD> $Revision$             </TD></TR>
   <TR><TD>Change Date:   </TD><TD> $Date$ </TD></TR>
   <TR><TD>Change history:</TD><TD> see CVS log                  </TD></TR>
</TABLE>

<!--==================================================================-->

<A NAME="OVERVIEW"></A>
<HR>
<H2>OVERVIEW</H2>

<P>
   This is a standard interface between the DART framework and the 
   standard model_mod wrapper that surrounds a model being incorporated
   into DART. Many of the interfaces are passed through nearly directly
   to the model_mod which is documented in detail in the DART views 
   document.
</P>
<P>
</P>

<!--==================================================================-->

<A NAME="OTHER MODULES USED"></A>
<BR><HR><BR>
<H2>OTHER MODULES USED</H2>
<PRE>
types_mod
location_mod
time_manager_mod
utilities_mod
model_mod
</PRE>

<!--==================================================================-->
<!--Note to authors. The first row of the table is different.         -->

<A NAME="Interface"></A>
<BR><HR><BR>
<H2>PUBLIC INTERFACE</H2>

<TABLE>
<TR><TD><em class=call>use xxxxxxx, only : </em></TD>
                   <TD><A HREF="#yyypubtype1">assim_model_type</A> &</TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine1">static_init_assim_model</A> &</TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine2">init_diag_output</A> &</TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine3">get_model_size</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine4">get_closest_state_time_to</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine5">get_initial_condition</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine6">get_state_meta_data</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine7">get_close_states</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine8">get_num_close_states</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine9">get_model_time</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine10">get_model_state_vector</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine11">copy_assim_model</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine12">advance_state</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine13">interpolate</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine15">set_model_time</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine16">set_model_state_vector</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine17">write_state_restart</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine18">read_state_restart</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine19">output_diagnostics</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine20">end_assim_model</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine21">assim_model_type</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine22">init_diag_input</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine23">input_diagnostics</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine24">get_diag_input_copy_meta_data</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine25">init_assim_model</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine26">get_state_vector_ptr</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine27">binary_restart_files</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine28">finalize_diag_output</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine29">aoutput_diagnostics</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine30">aread_state_restart</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine31">aget_closest_state_time_to</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine32">awrite_state_restart</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine33">Aadvance_state</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#yyyroutine34">pert_model_state</A></TD></TR>
</TABLE>

<H3 class=indent1>NOTES</H3>

<P>
Optional namelist interface <em class=code>&lim_obs_seq_nml</em> 
may be read from file <em class=file>input.nml</em>.
</P>

<!--==================================================================-->
<!-- Declare all public entities ...                                  -->
<!-- duplicate public routines template as many times as necessary    -->
<!-- make sure you replace all yyyroutine?? strings                   -->
<!--==================================================================-->

<A NAME="PublicEntities"></A>
<BR><HR><BR>
<H2>PUBLIC COMPONENTS</H2>
</P>

<!--=================== DESCRIPTION OF A LOCAL TYPE ==================-->

<A NAME="yyypubtype1"></A>
<BR><HR><BR>
<div class=type><pre>
<em class=call>type assim_model_type</em>
   private
   real(r8), pointer   :: state_vector(:) 
   type(time_type)     :: time
   integer             :: model_size
   integer             :: copyID
end type assim_model_type
</pre></div>

<H3 class=indent1>Description</H3>

<P>
This type is used to represent both the state and time of a state
from a model.
</P>

<TABLE border=0 cellpadding=3 width=100%>
<TR><TH align=left>Component   </TH>
    <TH align=left>Description </TH></TR>
<TR><TD valign=top> state_vector                       </TD>
    <TD>A one dimensional representation of the model state vector. </TD></TR>
<TR><TD valign=top> time                       </TD>
    <TD>The time of the model state. </TD></TR>
<TR><TD valign=top> model_size                       </TD>
    <TD>Size of the model state vector. </TD></TR>
<TR><TD valign=top> copyID                       </TD>
    <TD>Not used in present implementation.</TD></TR>
</TABLE>

<!--===================== DESCRIPTION OF SUBROUTINE =====================-->

<A NAME="yyyroutine1"></A>
<P></P><HR><P></P>
<div class=routine>
<em class=call>call static_init_assim_model() </em>
<pre>
</pre></div>

<H3 class=indent1>Description</H3>

<P>
   Initializes the assim_model class. Must be called before any other 
   assim_model_mod interfaces are used. Also calls the static initialization
   for the underlying model.
</P>

<H3 class=indent1>Notes</H3>

<!--===================== DESCRIPTION OF FUNCTION =====================-->

<A NAME="yyyroutine2"></A>
<P></P><HR><P></P>
<div class=routine>
<em class=call> ncFileID = init_diag_output(FileName, global_meta_data, 
   copies_of_field_per_time, meta_data_per_copy) </em>
<pre>
character (len = *)                                                   :: <em class=code> FileName </em>
character (len = *)                                                   :: <em class=code> global_meta_data </em>
integer, intent(in)                                                   :: <em class=code> copies_of_field_per_time </em>
character (len = *), intent(in), dimension(copies_of_field_per_time)  :: <em class=optionalcode> bob </em>
integer                                                               :: <em class=code> ncFileID </em>
</pre></div>

<H3 class=indent1>Description</H3>

<P>
   Initializes a netCDF file for output of state space diagnostics. A handle to 
   the channel on which the file is opened is returned.
</P>

<TABLE width=100% border=0 summary="" cellpadding=3>

<TR><TD valign=top><em class=code>FileName &nbsp; &nbsp; </em></TD>
    <TD>Name of file to open.</TD></TR>

<TR><TD valign=top><em class=code>global_meta_data</em></TD>
    <TD>Global metadata that describes the contents of this file.</TD></TR>

<TR><TD valign=top><em class=code>copies_of_field_per_time</em></TD>
    <TD> Number of copies of data to be written at each time. For instance,
         these could be the prior ensemble members, prior ensemble mean, 
         prior ensemble spread, posterior ensemble members, posterior
         spread and mean, etc..</TD></TR>
<TR><TD valign=top><em class=code>meta_data_per_copy</em></TD>
    <TD> Metadata describing each of the copies.</TD></TR>

<TR><TD valign=top><em class=code>ncFileID</em></TD>
    <TD>Channel number on which file is opened.</TD></TR>

</TABLE>

</P>

<!--===================== DESCRIPTION OF FUNCTION =====================-->

<A NAME="yyyroutine3"></A>
<P></P><HR><P></P>
<div class=routine>
<em class=call> var = get_model_size() </em>
<pre>
integer                               :: <em class=code>var </em>
</pre></div>

<H3 class=indent1>Description</H3>

<P>
  Returns the size of the model state vector. This is a direct pass 
   through to the model_mod.   
</P>

</P>

<!--===================== DESCRIPTION OF FUNCTION =====================-->

<A NAME="yyyroutine4"></A>
<P></P><HR><P></P>
<div class=routine>
<em class=call> var = get_closest_state_time_to(assim_model, time) </em>
<pre>
type(assim_model_type), intent(in)                :: <em class=code> assim_model </em>
type(time_type), intent(in)                       :: <em class=code> time</em>
type(time_type)                                   :: <em class=code> get_closest_state_time_to </em>
</pre></div>

<H3 class=indent1>Description</H3>

<P>
  Returns the closest time that a model is capable of advancing a given state to a 
  specified time. For instance, what is the closest time to 12GMT 01 January, 2004
  that a model state at 00GMT 01 January, 2004 can be advanced?  
</P>

<TABLE width=100% border=0 summary="" cellpadding=3>

<TR><TD valign=top><em class=code>assim_model &nbsp; &nbsp; </em></TD>
    <TD>A model state vector and time that might be advanced.</TD></TR>

<TR><TD valign=top><em class=code>time</em></TD>
    <TD>A time that one would like to get close to with the model.</TD></TR>

<TR><TD valign=top><em class=code>var</em></TD>
    <TD>The closest time to which the model can be advanced is returned.</TD></TR>

</TABLE>

</P>

<!--==================================================================-->
<!--=================== DESCRIPTION OF A NAMELIST  ===================-->

<A NAME="Namelist"></A>
<BR><HR><BR>
<H2>NAMELIST</H2>
<P>We adhere to the F90 standard of starting a namelist with an ampersand 
'&' and terminating with a slash '/'.
<div class=namelist><pre>
<em class=call>namelist / lim_obs_seq_nml / </em> &
    ens_size, spin_up_steps, num_steps, output_start, ens_spin_up_steps, &
    obs_freq, cov_inflate, mean_inflate, restart, add_on, noise_amp
</pre></div>

<H3 class=indent1>Discussion</H3>

<P>This namelist is read in a file called <em class=file>input.nml</em>
</P>

<TABLE border=0 cellpadding=3 width=100%>
<TR><TH align=left>Contents    </TH>
    <TH align=left>Type        </TH>
    <TH align=left>Description </TH></TR>
<TR><!--contents--><TD valign=top>ens_size             </TD>
    <!--  type  --><TD valign=top>integer <em class="unit">[default: 0]</em></TD>
    <!--descript--><TD>The number of "i" and "j" rows processed each time the 
    modular physics is called. </TD></TR>
<TR><!--contents--><TD valign=top>spin_up_steps        </TD>
    <!--  type  --><TD>integer                         </TD>
    <!--descript--><TD>the month                       </TD></TR>
<TR><!--contents--><TD valign=top>num_steps            </TD>
    <!--  type  --><TD>real(r8)                        </TD>
    <!--descript--><TD>the day-of-month                </TD></TR>
<TR><!--contents--><TD valign=top>output_start         </TD>
    <!--  type  --><TD>real(r4)                        </TD>
    <!--descript--><TD>the hour-of-day                 </TD></TR>
<TR><!--contents--><TD valign=top>ens_spin_up_steps    </TD>
    <!--  type  --><TD>real(r4)                        </TD>
    <!--descript--><TD>the minute                      </TD></TR>
<TR><!--contents--><TD valign=top>obs_freq,            </TD>
    <!--  type  --><TD>real(r4)                        </TD>
    <!--descript--><TD>the second                      </TD></TR>
<TR><!--contents--><TD valign=top>cov_inflate          </TD>
    <!--  type  --><TD>real(r8)                        </TD>
    <!--descript--><TD>uniformly monotonic time        </TD></TR>
<TR><!--contents--><TD valign=top>mean_inflate         </TD>
    <!--  type  --><TD>character(len=80)               </TD>
    <!--descript--><TD>the type of calendar being used </TD></TR>
<TR><!--contents--><TD valign=top>restart              </TD>
    <!--  type  --><TD>integer                         </TD>
    <!--descript--><TD>the type of calendar being used </TD></TR>
<TR><!--contents--><TD valign=top>add_on               </TD>
    <!--  type  --><TD>integer                         </TD>
    <!--descript--><TD>the type of calendar being used </TD></TR>
<TR><!--contents--><TD valign=top>noise_amp            </TD>
    <!--  type  --><TD>integer                         </TD>
    <!--descript--><TD>the type of calendar being used </TD></TR>
</TABLE>

<!--==================================================================-->
<!-- Describe the Files Used by this module.                          -->
<!--==================================================================-->

<A NAME="FilesUsed"></A>
<BR><HR><BR>
<H2>FILES</H2>
<UL><LI>inputfile1
    <LI>namelistfile
    <LI>outputfile
</UL>

<!--==================================================================-->
<!-- Cite references, if need be.                                     -->
<!--==================================================================-->

<A NAME="References"></A>
<BR><HR><BR>
<H2>REFERENCES</H2>

<!--==================================================================-->
<!-- Describe all the error conditions and codes.                     -->
<!-- Putting a <BR> after the synopsis creates a nice effect.         -->
<!--==================================================================-->

<A NAME="Errors"></A>
<HR>
<H2>ERROR CODES and CONDITIONS</H2>
<div class="errors">
<TABLE border=1 cellspacing=1 cellpadding=10 width=100%>
<TR><TH>Routine</TH><TH>Message</TH><TH>Comment</TH></TR>

<TR><!-- routine --><TD VALIGN=top>xxxx</TD>
    <!-- message --><TD VALIGN=top>size of [argument] is incorrect</TD>
    <!-- comment --><TD VALIGN=top>The size of [argument] must be 1 and 4</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>xxxx</TD>
    <!-- message --><TD VALIGN=top>yyyyy</TD>
    <!-- comment --><TD VALIGN=top>bad judgement<BR>
                        What were you thinking?</TD>
</TR>
</TABLE>
</div>

<!--==================================================================-->
<!-- Describe the bugs.                                               -->
<!--==================================================================-->

<A NAME="KnownBugs"></A>
<BR><HR><BR>
<H2>KNOWN BUGS</H2>
<P>
</P>

<!--==================================================================-->
<!-- Descibe Future Plans.                                            -->
<!--==================================================================-->

<A NAME="FuturePlans"></A>
<BR><HR><BR>
<H2>FUTURE PLANS</H2>
<P>
</P>

<!--==================================================================-->
<!-- Have not fleshed out this part yet ... ha ha ha                  -->
<!--==================================================================-->

<A NAME="PrivateComponents"></A>
<BR><HR><BR>
<H2>PRIVATE COMPONENTS</H2>

<div class=routine>
<pre>
type location_type
   private
   real(r8) :: x
end type location_type</pre>
</div>

<H3 class=indent1>Discussion</H3>

<!--==================================================================-->

<HR>
</BODY>
</HTML>
