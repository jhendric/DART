<HTML>
<HEAD>
<TITLE>PROGRAM merge_obs_seq</TITLE>
<link rel="stylesheet" type="text/css" href="../doc/html/doc.css"></link> 
</HEAD>
<BODY>
<!--
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!                                                                       !!
!!                   GNU General Public License                          !!
!!                                                                       !!
!! This file is part of the Data Assimilation Research Testbed (DART).   !!
!!                                                                       !!
!! DART is free software; you can redistribute it and/or modify          !!
!! it and are expected to follow the terms of the GNU General Public     !!
!! License as published by the Free Software Foundation.                 !!
!!                                                                       !!
!! DART is distributed in the hope that it will be useful,               !!
!! but WITHOUT ANY WARRANTY; without even the implied warranty of        !!
!! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         !!
!! GNU General Public License for more details.                          !!
!!                                                                       !!
!! You should have received a copy of the GNU General Public License     !!
!! along with DART; if not, write to:                                    !!
!!          Free Software Foundation, Inc.                               !!
!!          59 Temple Place, Suite 330                                   !!
!!          Boston, MA  02111-1307  USA                                  !!
!! or see:                                                               !!
!!          http://www.gnu.org/licenses/gpl.txt                          !!
!!                                                                       !!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-->

<DIV ALIGN=CENTER>
<A HREF="#Namelist">NAMELIST</A> / 
<A HREF="#FilesUsed">FILES</A> /
<A HREF="#References">REFERENCES</A> /
<A HREF="#Errors">ERRORS</A> /
<A HREF="#KnownBugs">BUGS</A> /
<A HREF="#FuturePlans">PLANS</A>
</DIV>

<!--==================================================================-->

<H1>PROGRAM merge_obs_seq</H1>
<A NAME="HEADER"></A>
<TABLE summary="">
<TR><TD>Contact:       </TD><TD> Tim Hoar </TD></TR>
<TR><TD>Revision:      </TD><TD> $Revision$ </TD></TR>
<TR><TD>Source:        </TD><TD> $URL$ </TD></TR>
<TR><TD>Change Date:   </TD><TD> $Date$ </TD></TR>
<TR><TD>Change history:</TD><TD> try "svn log" or "svn diff" </TD></TR>
</TABLE>

<!--==================================================================-->

<A NAME="OVERVIEW"></A>
<HR>
<H2>OVERVIEW</H2>

<P>
This program can merge two or more compatible observation sequences 
and create a single observation sequence file with the 
combined observations. The number of input files, their filenames,
and the output filename are read from the namelist file.
<BR><BR>
This program is also a convenient way to convert observation sequence
files from ASCII to (more compact) binary, or vice-versa. Simply specify
that there is 1 input file. The output format is specified by the 
<em class=code>&#38;obs_sequence_nml</em> namelist 
in file <em class=file>input.nml</em>.
<BR><BR>
This routine also uses a MUCH faster insertion method than the
versions that used only two input files. A test on
merging two 40000 observation sequences now takes less than 6 seconds
compared to more than 170 seconds for the old version. Since observation
sequences are linked lists ordered by time, simply keeping track of
where you inserted the last one greatly simplifies the logic of where
one starts looking to insert the next observation. Consequently, inserting
and appending are now equally fast. Snappy!
<BR><BR>
<em class=unix>merge_obs_seq</em> can be used to sort observations in an
observation sequence as well as physically delete broken nodes from 
the sequence. The only trick is to merge with an empty 
<em class=file>obs_seq</em> file. The empty <em class=file>obs_seq</em> 
must be specified first in the list of files to merge, it has to have a header, 
and first = last = -1. Pretty Sneaky.
</P>


<!--==================================================================-->

<A NAME="OTHER MODULES USED"></A>
<BR><HR><BR>
<H2>OTHER MODULES USED</H2>
<PRE>
types_mod
utilities_mod
time_manager_mod
obs_def_mod
obs_sequence_mod
</PRE>

<!--============== DESCRIPTION OF A NAMELIST ========================-->
<A NAME="Namelist"></A>
 <BR><HR><BR>
 <P>We adhere to the F90 standard of starting a namelist with an ampersand
 '&#38;' and terminating with a slash '/'.
 </P>
 <div class=namelist><pre>
 <em class=call>namelist / merge_obs_seq / </em> num_input_files, filename_seq, filename_out
 </pre></div>

 <H3 class=indent1>Discussion</H3>
 <P>
 This routine is intended to consolidate observation sequence files.
 It can also be used to convert an observation sequence file from
 (large, but portable) ASCII to (compact, but impenetrable) binary
 throught the use of the <em class=code>write_binary_obs_sequence</em>
 namelist variable.
 </P>

 <P>
 This namelist is read in a file called <em class=file>input.nml</em>
 </P>

 <TABLE border=0 cellpadding=3 width=100%>
 <TR><TH align=left>Contents    </TH>
     <TH align=left>Type        </TH>
     <TH align=left>Description </TH></TR>
 <TR><!--contents--><TD valign=top>num_input_files</TD>
     <!--  type  --><TD>integer</TD>
     <!--descript--><TD>The number of observation sequence files to merge.
                        Maximum of 50.
                        Default: 2</TD></TR>
 <TR><!--contents--><TD valign=top>filename_seq</TD>
     <!--  type  --><TD>character(len=129) dim=50</TD>
     <!--descript--><TD>The array of names of the observation sequence files to merge.
                        With the F90 namelist mechanism, it seems it is only necessary
                        to specify the names you are going to use, not necessarily all 50.
                        Default: 'obs_seq.one', 'obs_seq.two'</TD></TR>
 <TR><!--contents--><TD valign=top>filename_out</TD>
     <!--  type  --><TD>character(len=129)</TD>
     <!--descript--><TD>The name of the resulting (merged) observation sequence file.
                        Default: 'obs_seq.merged'</TD></TR>
 </TABLE>
 

<!--==================================================================-->
<!-- Describe the Files Used by this module.                          -->
<!--==================================================================-->

<A NAME="FilesUsed"></A>
<BR><HR><BR>
<H2>FILES</H2>
<UL><LI><em class="file">input.nml</em></LI>
    <LI>The input files specified in the <em class="code">filename_seq</em>
        namelist variable.</LI>
    <LI>The output file specified in the <em class="code">filename_out</em>
        namelist variable.</LI>
</UL>


<!--==================================================================-->
<!-- Cite references, if need be.                                     -->
<!--==================================================================-->

<A NAME="References"></A>
<BR><HR><BR>
<H2>REFERENCES</H2>

<!--==================================================================-->
<!-- Describe all the error conditions and codes.                     -->
<!-- Putting a <BR> after the synopsis creates a nice effect.         -->
<!--==================================================================-->

<A NAME="Errors"></A>
<HR>
<H2>ERROR CODES and CONDITIONS</H2>
<div class="errors">
<TABLE border=1 cellspacing=1 cellpadding=10 width=100%>
<TR><TH>Routine</TH><TH>Message</TH><TH>Comment</TH></TR>

<TR><!-- routine --><TD VALIGN=top>merge_obs_seq</TD>
    <!-- message --><TD VALIGN=top>num_input_files &#62; max_num_input_files. 
		    change max_num_input_files in source file</TD>
    <!-- comment --><TD VALIGN=top>The default is 50 files. If you're trying to 
		    merge more than that, you're going about it the wrong way ...</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>merge_obs_seq</TD>
    <!-- message --><TD VALIGN=top>num_input_files and filename_seq mismatch</TD>
    <!-- comment --><TD VALIGN=top>methinks you did not specify a file name for the 
                        number of files you told me you were merging.</TD>
</TR>
</TABLE>
</div>

<!--==================================================================-->
<!-- Describe the bugs.                                               -->
<!--==================================================================-->

<A NAME="KnownBugs"></A>
<BR><HR><BR>
<H2>KNOWN BUGS</H2>
<P>
There are no known bugs. Really.
</P>

<!--==================================================================-->
<!-- Descibe Future Plans.                                            -->
<!--==================================================================-->

<A NAME="FuturePlans"></A>
<BR><HR><BR>
<H2>FUTURE PLANS</H2>
<P>
There are no future plans.
</P>

<!--==================================================================-->
<!-- Have not fleshed out this part yet ... ha ha ha                  -->
<!--==================================================================-->


<H3 class=indent1>Discussion</H3>

<!--==================================================================-->

<HR>
</BODY>
</HTML>
