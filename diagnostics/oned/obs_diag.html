<!--
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!                                                                       !!
!!                   GNU General Public License                          !!
!!                                                                       !!
!! This file is part of the Data Assimilation Research Testbed (DART).   !!
!!                                                                       !!
!! DART is free software; you can redistribute it and/or modify          !!
!! it and are expected to follow the terms of the GNU General Public     !!
!! License as published by the Free Software Foundation.                 !!
!!                                                                       !!
!! DART is distributed in the hope that it will be useful,               !!
!! but WITHOUT ANY WARRANTY; without even the implied warranty of        !!
!! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         !!
!! GNU General Public License for more details.                          !!
!!                                                                       !!
!! You should have received a copy of the GNU General Public License     !!
!! along with DART; if not, write to:                                    !!
!!          Free Software Foundation, Inc.                               !!
!!          59 Temple Place, Suite 330                                   !!
!!          Boston, MA  02111-1307  USA                                  !!
!! or see:                                                               !!
!!          http://www.gnu.org/licenses/gpl.txt                          !!
!!                                                                       !!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-->

<HTML>
<TITLE>program obs_diag</TITLE>
<link rel=stylesheet type=text/css href=../doc/html/doc.css>
<BODY>

<DIV ALIGN=CENTER>
<A HREF="#Modules">MODULES</A> / 
<A HREF="#Namelist">NAMELIST</A> / 
<A HREF="#FilesUsed">FILES</A> /
<A HREF="#References">REFERENCES</A> /
<A HREF="#Errors">ERRORS</A> /
<A HREF="#KnownBugs">BUGS</A> /
<A HREF="#FuturePlans">PLANS</A>
</DIV>

<!--==================================================================-->

<H1>PROGRAM obs_diag</H1>
<A NAME="HEADER"></A>
<TABLE summary="">
   <TR><TD>Contact:       </TD><TD> Tim Hoar                     </TD></TR>
   <TR><TD>Reviewers:     </TD><TD> &nbsp;                       </TD></TR>
   <TR><TD>Revision:      </TD><TD> $Revision$             </TD></TR>
   <TR><TD>Release Name:  </TD><TD> $Name$                    </TD></TR>
   <TR><TD>Change Date:   </TD><TD> $Date$ </TD></TR>
   <TR><TD>Change history:</TD><TD> see CVS log </TD></TR>
</TABLE>

<!--==================================================================-->

<A NAME="OVERVIEW"></A>
<HR>
<H2>OVERVIEW</H2>

<P>
   Main program for observation-space diagnostics for the models with
   1D locations. The model space is carved up into regions, hence the
   dependency on the location type. There is no discrimination between
   observation types, but the framework is still in the code - the main
   selection block is commented out. The result of the code is a pair of
   ASCII files that contain the RMS of the bias and the RMS of the spread
   of the prior (aka 'guess') and posterior (aka 'analysis') estimates 
   as a function of time and region.  
</P>
   
<P>The namelist contains several unused features that are simply used 
   to facilitate the matlab plotting routines until such time as the 
   output is reformatted to a netCDF file.  This documentation was 
   created for the DA Workshop, summer 2005.
</P>

<P>
Optional namelist interface
<A HREF="#Namelist"><em class=code>&#38;obsdiag_nml</em></A>
may be read from file <em class=file>input.nml</em>.
</P>

<!--==================================================================-->

<A NAME="Modules"></A>
<BR><HR><BR>
<H2>MODULES DIRECTLY USED</H2>
<PRE>
types_mod
obs_sequence_mod
obs_def_mod
location_mod
time_manager_mod
utilities_mod
</PRE>

<H2>MODULES INDIRECTLY USED</H2>
<PRE>
random_seq_mod
random_nr_mod
assim_model_mod
model_mod
</PRE>

<!--==================================================================-->
<!--=================== DESCRIPTION OF A NAMELIST  ===================-->

<A NAME="Namelist"></A>
<BR><HR><BR>
<H2>NAMELIST</H2>
<P>We adhere to the F90 standard of starting a namelist with an ampersand 
'&#38;' and terminating with a slash '/'.
<div class=namelist><pre>
<em class=call>namelist / obsdiag_nml / </em>
      obs_sequence_name, obs_year, obs_month, obs_day,
      tot_days, iskip, level, obs_select, rat_cri,
      qc_threshold, bin_separation, bin_width
</pre></div>

<H3 class=indent1>Discussion</H3>

<P>This namelist is read in a file called <em class=file>input.nml</em>
</P>

<TABLE border=0 cellpadding=3 width=100%>
<TR><TH align=left>Contents    </TH>
    <TH align=left>Type        </TH>
    <TH align=left>Description </TH></TR>
<TR><!--contents--><TD valign=top>obs_sequence_name        </TD>
    <!--  type  --><TD valign=top>character(len=129)       </TD>
    <!--descript--><TD>Contains name of observation sequence file.
		       Default is "obs_seq.final"
		       </TD></TR>

<TR><!--contents--><TD valign=top>obs_year       </TD>
    <!--  type  --><TD valign=top>integer        </TD>
    <!--descript--><TD>not used - Default is 0.  </TD></TR>  

<TR><!--contents--><TD valign=top>obs_month      </TD>
    <!--  type  --><TD valign=top>integer        </TD>
    <!--descript--><TD>not used - Default is 1.  </TD></TR>  

<TR><!--contents--><TD valign=top>obs_day        </TD>
    <!--  type  --><TD valign=top>integer        </TD>
    <!--descript--><TD>not used - Default is 1.  </TD></TR>  

<TR><!--contents--><TD valign=top>tot_days       </TD>
    <!--  type  --><TD valign=top>integer        </TD>
    <!--descript--><TD>not used - Default is 1.  </TD></TR>  

<TR><!--contents--><TD valign=top>iskip          </TD>
    <!--  type  --><TD valign=top>integer        </TD>
    <!--descript--><TD>not used - Default is 0.  </TD></TR>  

<TR><!--contents--><TD valign=top>level          </TD>
    <!--  type  --><TD valign=top>integer        </TD>
    <!--descript--><TD>not used - Default is 0.  </TD></TR>  

<TR><!--contents--><TD valign=top>obs_select     </TD>
    <!--  type  --><TD valign=top>integer        </TD>
    <!--descript--><TD>not used - Default is 1.  </TD></TR>  

<TR><!--contents--><TD valign=top>rat_cri        </TD>
    <!--  type  --><TD valign=top>real(r8)       </TD>
    <!--descript--><TD>Observation rejection ratio. 
	    If the following ratio is greater than rat_cri, 
	    the observation is rejected. 
	    abs(prior_mean - obsval) / sqrt( prior_spread + obs error variance).
	    Since we don't have all the ensemble members (in general) we cannot
	    calculate the covariance term that should be in the 
	    denominator, so it is not really the normalized distance. 
	    Default is 3.0.</TD></TR> 

<TR><!--contents--><TD valign=top>qc_threshold      </TD>
    <!--  type  --><TD valign=top>real(r8)          </TD>
    <!--descript--><TD>Maximum allowable QC value.
	    Default is 4.0.                         </TD></TR>

<TR><!--contents--><TD valign=top>bin_separation    </TD>
    <!--  type  --><TD valign=top>integer           </TD>
    <!--descript--><TD>The time between assimilations. 
	    Default is 3600 (seconds).              </TD></TR>

<TR><!--contents--><TD valign=top>bin_width         </TD>
    <!--  type  --><TD valign=top>integer           </TD>
    <!--descript--><TD>The window of time about the assimilation times in which
	    to search for observations. Since the 1D models all have 
	    observations at exactly the assimilation times, this is usually 
	    zero for these models.  Default is 0.   </TD></TR>
</TABLE>

<!--==================================================================-->
<!-- Describe the Files Used by this module.                          -->
<!--==================================================================-->

<A NAME="FilesUsed"></A>
<BR><HR><BR>
<H2>FILES</H2>
<UL>
   <LI>input namelist; <em class=file>input.nml</em>
   <LI>observation sequence file (input) ; from obs_sequence_name
   <LI>output state space 'guess' file; <em class=file>rawges_times_<i>xxxx</i>mb.dat</em>
   <LI>output state space 'analysis' file; <em class=file>rawanl_times_<i>xxxx</i>mb.dat</em>
   <LI>output plotting attributes file; <em class=file>ObsDiagAtts.m</em>
</UL>

<H3>File formats</H3>
We intend to write the output as netCDF files eventually. Until then,
here's the rosetta stone...

<TABLE>
	<TR><TD>column 1</TD><TD>day of observation</TD></TR>
	<TR><TD>column 2</TD><TD>seconds of observation</TD></TR>
	<TR><TD>column 3</TD><TD>rms of bias</TD></TR>
	<TR><TD>column 4</TD><TD>rms of spread</TD></TR>
	<TR><TD>column 5</TD><TD>number of observations</TD></TR>
	<TR><TD colspan=2>Columns 3,4,5 are repeated for each region</TD></TR>
</TABLE>
If there are no observations in a particular region, the default value of
-99 is used for the bias and spread. The regions themselves are logged
in <em class=file>ObsDiagAtts.m</em>.

<!--==================================================================-->
<!-- Cite references, if need be.                                     -->
<!--==================================================================-->

<A NAME="References"></A>
<BR><HR><BR>
<H2>REFERENCES</H2>

<!--==================================================================-->
<!-- Describe all the error conditions and codes.                     -->
<!-- Putting a <BR> after the synopsis creates a nice effect.         -->
<!--==================================================================-->

<A NAME="Errors"></A>
<HR>
<H2>ERROR CODES and CONDITIONS</H2>
<div class="errors">
<TABLE border=1 cellspacing=1 cellpadding=10 width=100%>
<TR><TH>Routine</TH><TH>Message</TH><TH>Comment</TH></TR>

<TR><!-- routine --><TD VALIGN=top>get_last_obs</TD>
    <!-- message --><TD VALIGN=top>No "last" observation in sequence</TD>
    <!-- comment --><TD VALIGN=top>Must have an incomplete observation sequence file. </TD>
<TR><!-- routine --><TD VALIGN=top>get_first_obs</TD>
    <!-- message --><TD VALIGN=top>No Observations in sequence.</TD>
    <!-- comment --><TD VALIGN=top>Empty observation sequence file.</TD>
</TR>
</TR>

</TABLE>
</div>

<!--==================================================================-->
<!-- Describe the bugs.                                               -->
<!--==================================================================-->

<A NAME="KnownBugs"></A>
<BR><HR><BR>
<H2>KNOWN BUGS</H2>
<P>
</P>

<!--==================================================================-->
<!-- Descibe Future Plans.                                            -->
<!--==================================================================-->

<A NAME="FuturePlans"></A>
<BR><HR><BR>
<H2>FUTURE PLANS</H2>
<P>
Change output format to netCDF, eliminate reliance on ancillary
plotting attributes file: <em class=file>ObsDiagAtts.m</em>.
</P>

<!--==================================================================-->
<!-- Have not fleshed out this part yet ... ha ha ha                  -->
<!--==================================================================-->

<H3 class=indent1>Discussion</H3>

None at this time.

<!--==================================================================-->

<HR>
</BODY>
</HTML>
