<HTML>
<HEAD>
<TITLE>program wind_obs_to_table</TITLE>
<link rel="stylesheet" type="text/css" href="../../doc/html/doc.css"></link> 
</HEAD>
<BODY>
<!--
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!                                                                       !!
!!                   GNU General Public License                          !!
!!                                                                       !!
!! This file is part of the Data Assimilation Research Testbed (DART).   !!
!!                                                                       !!
!! DART is free software; you can redistribute it and/or modify          !!
!! it and are expected to follow the terms of the GNU General Public     !!
!! License as published by the Free Software Foundation.                 !!
!!                                                                       !!
!! DART is distributed in the hope that it will be useful,               !!
!! but WITHOUT ANY WARRANTY; without even the implied warranty of        !!
!! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         !!
!! GNU General Public License for more details.                          !!
!!                                                                       !!
!! You should have received a copy of the GNU General Public License     !!
!! along with DART; if not, write to:                                    !!
!!          Free Software Foundation, Inc.                               !!
!!          59 Temple Place, Suite 330                                   !!
!!          Boston, MA  02111-1307  USA                                  !!
!! or see:                                                               !!
!!          http://www.gnu.org/licenses/gpl.txt                          !!
!!                                                                       !!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-->

<DIV ALIGN=CENTER>
<A HREF="#Modules">MODULES</A> / 
<A HREF="#Namelist">NAMELIST</A> / 
<A HREF="#FilesUsed">FILES</A> /
<A HREF="#Usage">USAGE </A> / 
<A HREF="#References">REFERENCES</A> /
<A HREF="#Errors">ERRORS</A> /
<A HREF="#KnownBugs">BUGS</A> /
<A HREF="#FuturePlans">PLANS</A> /
<A HREF="#PrivateComponents">PRIVATE COMPONENTS</A>
</DIV>

<!--==================================================================-->

<H1>PROGRAM wind_obs_to_table</H1>
<A NAME="HEADER"></A>

<!--==================================================================-->

<A NAME="OVERVIEW"></A>
<HR>
<H2>OVERVIEW</H2>

<P>
   <em class=program>wind_obs_to_table</em> 
   is a routine to extract the U and V horizontal components from
   observation sequence files and write out 'simple' ASCII files 
   that can be easily digested by other applications. If the DART QC field
   is available (i.e. you are processing <em class="file">obs_seq.final</em>
   files, this routine will allow you to plot the spatial distribution
   of the wind observations and be able to discern which observations were
   assimilated or rejected, for example.
   <br />
   <br />
   The intent is that user input is queried and a series of output
   files -&nbsp;one&nbsp;per&nbsp;assimilation&nbsp;cycle&nbsp;- 
   will contain the observations for that cycle. It is hoped this will
   be useful for experiment design. This routine is also the first to 
   use the new <em class=program>schedule_mod</em> module which will 
   ultimately control the temporal aspects of the assimilations 
   (i.e. the assimilation schedule). 
</P>

   <H3 class="indent1">What's on the horizon ...</H3>
<P>
   <em class=program>wind_obs_to_table</em> 
   is a step toward encoding our observations in netCDF files.
   We are also exploring plotting facilities to examine the spatial
   distributions of quantities like bias between the ensemble mean and
   the observations ...
</P>


<P>
   Optional namelist interfaces
   <A HREF="#Namelist"><em class=code>&#38;wind_obs_to_table_nml</em></A> and
   <A HREF="../../time_manager/schedule_mod.html#Namelist"><em class=code>&#38;schedule_nml</em></A>
   may be read from file <em class=file>input.nml</em>.
</P>

<!--==================================================================-->

<A NAME="Modules"></A>
<BR><HR><BR>
<H2>OTHER MODULES USED</H2>
<PRE>
location_mod
netcdf
obs_def_mod
obs_kind_mod
obs_sequence_mod
schedule_mod
time_manager_mod
typeSizes
types_mod
utilities_mod
</PRE>
<P>
Naturally, the program must be compiled with support for the observation
types contained in the observation sequence files, so
<em class="program">preprocess</em> must be run to build appropriate
<em class="file">obs_def_mod</em> and 
<em class="file">obs_kind_mod</em> modules - which may need specific
obs_def_?????.f90 files.
</P>


<!--==================================================================-->
<!--=================== DESCRIPTION OF A NAMELIST  ===================-->

<A NAME="Namelist"></A>
<BR><HR><BR>
<H2>NAMELIST</H2>
<P>We adhere to the F90 standard of starting a namelist with an 
   ampersand '&#38;' and terminating with a slash '/'.
   <div class=namelist><pre>
   <em class=call>namelist / wind_obs_to_table_nml / </em> &#38;
      obs_sequence_name, lonlim1, lonlim2, latlim1, latlim2, verbose
   </pre></div>
</P>

<H3 class=indent1>Discussion</H3>

<P>This namelist is read in a file called <em class=file>input.nml</em>. <BR>
   The allowable ranges for the region boundaries are: latitude [-90.,90], 
   longitude [0.,360.] ... but it is possible to specify a region that spans
   the dateline by specifying the <em class="code">lonlim2</em> to be less 
   than <em class="code">lonlim1</em>.
</P>


<TABLE border=0 cellpadding=3 width=100%>
<TR><TH align=left>Contents    </TH>
    <TH align=left>Type        </TH>
    <TH align=left>Description </TH></TR>

<TR><!--contents--><TD valign=top> obs_sequence_name  </TD>
    <!--  type  --><TD valign=top> character(len=129) </TD>
    <!--descript--><TD>Name of the observation sequence files. <BR>
            This may be a relative or absolute filename. If the filename
            contains a '/', the filename is considered to be comprised of
	    everything to the right, and a directory structure to the left.
	    The directory structure is then queried to see if it can be
	    incremented to handle a sequence of observation files.
	    The default behavior of <em class="program">wind_obs_to_table</em> 
	    is to look for additional files to include until the files 
	    are exhausted or an <em class=file>obs_seq.final</em> file 
	    is found that contains observations beyond the timeframe of 
	    interest.<BR>e.g. 'obsdir_001/obs_seq.final' will cause
	    <em class="program">wind_obs_to_table</em> to look for
	    'obsdir_002/obs_seq.final', and so on.<BR>
	    Default 'obs_seq.final'</TD></TR>  

<TR><!--contents--><TD valign=top>   lonlim1   </TD>
    <!--  type  --><TD valign=top>   real      </TD>
    <!--descript--><TD>Westernmost longitude of the region.<BR>
	    Default: none </TD></TR>  

<TR><!--contents--><TD valign=top>   lonlim2   </TD>
    <!--  type  --><TD valign=top>   real      </TD>
    <!--descript--><TD>Easternmost longitude of the region.
            <em class="new">If this value is <b>less than</b>
	    the westernmost value, it defines a region that spans the 
	    prime meridian. No problem.</em> It is perfectly acceptable 
	    to specify lonlim1 = 330 , lonlim2 = 50 to identify a region
	    like "Africa".<BR>
	    Default: none</TD></TR>  

<TR><!--contents--><TD valign=top>   latlim1    </TD>
    <!--  type  --><TD valign=top>   real       </TD>
    <!--descript--><TD>Southernmost latitude of the region.<BR>
	    Default: none</TD></TR>  

<TR><!--contents--><TD valign=top>   latlim2    </TD>
    <!--  type  --><TD valign=top>   real       </TD>
    <!--descript--><TD>Northernmost latitude of the region.<BR>
	    Default: none</TD></TR>  

<TR><!--contents--><TD valign=top>   verbose   </TD>
    <!--  type  --><TD valign=top>   logical   </TD>
    <!--descript--><TD>Print extra info about the wind_obs_to_table run.<BR>
            Default: .false. </TD></TR>  

</TABLE>

<!--==================================================================-->
<!-- Describe the Files Used by this module.                          -->
<!--==================================================================-->

<A NAME="FilesUsed"></A>
<BR><HR><BR>
<H2>FILES</H2>
<UL><LI><em class="file">input.nml</em> is used for 
        <em class="code">wind_obs_to_table_nml</em> and 
        <em class="code">schedule_nml</em>.
	</LI>
    <LI><em class="file">wind_obs_to_table_output.nc</em> is a 
        netCDF output file with all the metadata (for now) and will
	have the observation values and derived quantities in the near future.</LI>
    <LI><em class="file">dart_log.out</em> list directed output 
        from the wind_obs_to_table.</LI>
    <LI><em class="file">wind_vectors.xxx.dat</em> contains the
    locations for all the wind observations in temporal bin "xxx".</LI>
</UL>

<H3 class=indent1>Discussion of wind_obs_to_table_output.nc variables</H3>
<P>
These are the metadata for all the ASCII ouput files.
Between the output files and the netCDF file, you have everything
you need to make sensible plots of the wind observations.
</P>

<!--==================================================================-->
<!-- Discuss  typical usage of wind_obs_to_table.                              -->
<!--==================================================================-->

<A NAME="Usage"></A>
<BR><HR><BR>
<H2>USAGE</H2>

<P>
<em class="program">wind_obs_to_table</em> is built and run in 
...<em class="file">/DART/models/</em>your_model<em class="file">/work</em>, 
in the same way as the other DART components. After the program has been run,
<em class="file">/DART/diagnostics/matlab/</em><em
class="program">plot_wind_vectors.m</em> can be run to plot the wind
observations.
</P>

<!--==================================================================-->
<!-- Cite references, if need be.                                     -->
<!--==================================================================-->

<A NAME="References"></A>
<BR><HR><BR>
<H2>REFERENCES</H2>

<!--==================================================================-->
<!-- Describe all the error conditions and codes.                     -->
<!-- Putting a <BR> after the synopsis creates a nice effect.         -->
<!--==================================================================-->

<A NAME="Errors"></A>
<HR>
<H2>ERROR CODES and CONDITIONS</H2>
<div class="errors">
<TABLE border=1 cellspacing=1 cellpadding=10 width=100%>
<TR><TH>Routine</TH><TH>Message</TH><TH>Comment</TH></TR>

<TR><!-- routine --><TD VALIGN=top>wind_obs_to_table</TD>
    <!-- message --><TD VALIGN=top>No first observation in sequence.</TD>
    <!-- comment --><TD VALIGN=top>get_first_obs couldn't find a "first obs" 
                                   in the obs_seq.final. </TD>
</TR>
<TR><!-- routine --><TD VALIGN=top>wind_obs_to_table</TD>
    <!-- message --><TD VALIGN=top>No last observation in sequence</TD>
    <!-- comment --><TD VALIGN=top>get_last_obs couldn't find a "last obs" 
                                   in the obs_seq.final </TD>
</TR>
<TR><!-- routine --><TD VALIGN=top>wind_obs_to_table</TD>
    <!-- message --><TD VALIGN=top>metadata:observation not found</TD>
    <!-- comment --><TD VALIGN=top>Couldn't find the index for the
    observation value in the observation sequence file. It is the only
    one that is required.</TD>
</TR>
</TABLE>
</div>

<A NAME="PrivateComponents"></A>
<BR><HR><BR>
<H2>PRIVATE COMPONENTS</H2>
<!--==================================================================-->
<!-- Internal subroutines and functions.                              -->
<!--==================================================================-->


<!--==================================================================-->
<!-- Describe the bugs.                                               -->
<!--==================================================================-->
<A NAME="KnownBugs"></A>
<BR><HR><BR>
<H2>KNOWN BUGS</H2>
<P>
none at this time
</P>

<!--==================================================================-->
<!-- Descibe Future Plans.                                            -->
<!--==================================================================-->

<A NAME="FuturePlans"></A>
<BR><HR><BR>
<H2>FUTURE PLANS</H2>
<P>
Extend to handle derived quantities for all observation types, not just
wind speed. It would be nice to plot the spatial distribution of observation
bias, for example.
</P>

<!--==================================================================-->

<HR>
<TABLE summary="">
<TR><TD>Contact:       </TD><TD> Tim Hoar </TD></TR>
<TR><TD>Revision:      </TD><TD> $Revision$ </TD></TR>
<TR><TD>Source:        </TD><TD> $URL$ </TD></TR>
<TR><TD>Change Date:   </TD><TD> $Date$ </TD></TR>
<TR><TD>Change history:</TD><TD> try "svn log" or "svn diff" </TD></TR>
</TABLE>
<HR>
</BODY>
</HTML>
