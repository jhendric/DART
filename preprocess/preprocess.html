<!--
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!                                                                       !!
!!                   GNU General Public License                          !!
!!                                                                       !!
!! This file is part of the Data Assimilation Research Testbed (DART).   !!
!!                                                                       !!
!! DART is free software; you can redistribute it and/or modify          !!
!! it and are expected to follow the terms of the GNU General Public     !!
!! License as published by the Free Software Foundation.                 !!
!!                                                                       !!
!! DART is distributed in the hope that it will be useful,               !!
!! but WITHOUT ANY WARRANTY; without even the implied warranty of        !!
!! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         !!
!! GNU General Public License for more details.                          !!
!!                                                                       !!
!! You should have received a copy of the GNU General Public License     !!
!! along with DART; if not, write to:                                    !!
!!          Free Software Foundation, Inc.                               !!
!!          59 Temple Place, Suite 330                                   !!
!!          Boston, MA  02111-1307  USA                                  !!
!! or see:                                                               !!
!!          http://www.gnu.org/licenses/gpl.txt                          !!
!!                                                                       !!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-->

<HTML>
<TITLE>program preprocess</TITLE>
<link rel="stylesheet" type="text/css" href="../doc/html/doc.css">
<BODY>

<DIV ALIGN=CENTER>
<A HREF="#Interface">INTERFACE</A> / 
<A HREF="#PublicEntities">PUBLIC COMPONENTS</A> / 
<A HREF="#Namelist">NAMELIST</A> / 
<A HREF="#FilesUsed">FILES</A> /
<A HREF="#References">REFERENCES</A> /
<A HREF="#Errors">ERRORS</A> /
<A HREF="#KnownBugs">BUGS</A> /
<A HREF="#FuturePlans">PLANS</A> /
<A HREF="#PrivateComponents">PRIVATE COMPONENTS</A>
</DIV>

<!--==================================================================-->

<H1>PROGRAM preprocess</H1>
<A NAME="HEADER"></A>
<TABLE summary="">
   <TR><TD>Contact:       </TD><TD> Jeff Anderson                </TD></TR>
   <TR><TD>Reviewers:     </TD><TD> &nbsp;                       </TD></TR>
   <TR><TD>Revision:      </TD><TD> $Revision$             </TD></TR>
   <TR><TD>Change Date:   </TD><TD> $Date$ </TD></TR>
   <TR><TD>Change history:</TD><TD> see CVS log (cop-out, I know)</TD></TR>
</TABLE>

<!--==================================================================-->

<A NAME="OVERVIEW"></A>
<HR>
<H2>OVERVIEW</H2>

<P>
Program to create observation kind and observation defintion modules (normally
obs_kind_mod.f90 and obs_def_mod.f90) from a set of other extended format Fortran90 
files. There are three kinds of input files: a default template for the obs_kind_mod
normally DEFAULT_obs_kind_mod.F90 in the obs_kind directory; a default template of the
obs_def_mod, normally DEFAULT_obs_def_mod.F90 in the obs_def directory; 0 or more
special obs_def modules such as obs_def_mod_reanalysis_bufr_mod.f90 found in the
obs_def directory. The DEFAULT_obs_kind_mod.F90 and DEFAULT_obs_def_mod.F90 are
used as templates into which required information from all specified 
special obs_def modules is inserted. If no special obs_def modules are specified
by the namelist, then the DEFAULT_obs_kind_mod.F90 and DEFAULT_obs_def_mod.F90 are 
copied directly to the final obs_kind and obs_def modules, normally obs_kind_mod.f90
in the obs_kind directory and obs_def_mod.f90 in the obs_def directory. In this
default case, only identity observations can be used by the filter (i.e. the
state variable values are directly observed; forward operator is an identity).
<P>
If one or more special obs_def files are specified, information from these files
is incorporated into the output obs_def and obs_kind modules and the observation
types specified in the special obs_def files will be available for use by the
filter programs.
<P>
The special obs_def files must contain a number of sections of specially formatted
F90 comments. They can also contain F90 code required for implementing operations
needed for the observations. These sections are described in the documentation for
the special obs_def modules, especially see obs_def_1d_state_mod.f90.
<P> The DEFAULT obs_kind and obs_def modules also require specially commented
sections to indicate where code from the special obs_def modules is to be 
inserted. See the documentation for the DEFAULT_obs_kind_mod.F90 and
the DEFAULT_obs_def_mod.F90 for details.




</P>

<!--==================================================================-->

<A NAME="OTHER MODULES USED"></A>
<BR><HR><BR>
<H2>OTHER MODULES USED</H2>
<PRE>
types_mod
utilities_mod
</PRE>

<P>
Namelist interface <em class=code>&preprocess_nml</em> 
must be read from file <em class=file>input.nml</em>.
</P>

<!--==================================================================-->
<!-- Declare all public entities ...                                  -->
<!-- duplicate public routines template as many times as necessary    -->
<!-- make sure you replace all yyyroutine?? strings                   -->
<!--==================================================================-->


<!--==================================================================-->
<!--=================== DESCRIPTION OF A NAMELIST  ===================-->
<!--==================================================================-->

<A NAME="Namelist"></A>
<BR><HR><BR>
<H2>NAMELIST</H2>
<P>We adhere to the F90 standard of starting a namelist with an ampersand 
'&amp;' and terminating with a slash '/'.

<div class=namelist><pre>
<em class=call>namelist / preprocess_nml/ </em> &amp;
  input_obs_def_mod_file, input_obs_kind_mod_file, output_obs_def_mod_file, 
  output_obs_kind_mod_file, input_files(max_input_files) 
</pre></div>
</P>

<H3 class=indent1>Discussion</H3>

<P>This namelist is read in a file called <em class=file>input.nml</em>
</P>

<TABLE border=0 cellpadding=3 width=100%>
<TR><TH align="left" width="15%">Contents    </TH>
    <TH align="left" width="30%">Type        </TH>
    <TH align="left" width="55%">Description </TH></TR>
<TR><!--contents--><TD valign=top>input_obs_def_mod_file           </TD>
    <!--  type  --><TD valign=top>character(len=129)<BR>
          <em class="unit">[default: 'null']</em></TD>
    <!--descript--><TD> Path name of input obs definition module to be
     preprocessed. Normally this is 
    <em class="file">DEFAULT_obs_def_mod.F90</em> in the obs_def
     directory. This file must have the appropriate commented lines indicating
     where the different parts of the input special obs definition modules
     are to be inserted.  </TD></TR>
<TR><!--contents--><TD valign=top>output_obs_def_mod_file           </TD>
    <!--  type  --><TD valign=top>character(len=129)<BR>
          <em class="unit">[default: 'null']</em></TD>
    <!--descript--><TD> Path name of output obs definition module to be
     created by preprocessor. Normally this is 
    <em class="file">obs_def_mod.f90</em> in the obs_def
     directory.   </TD></TR>
<TR><!--contents--><TD valign=top>input_obs_kind_mod_file           </TD>
    <!--  type  --><TD valign=top>character(len=129)<BR>
          <em class="unit">[default: 'null']</em></TD>
    <!--descript--><TD> Path name of input obs kind module to be
     preprocessed. Normally this is 
    <em class="file">DEFAULT_obs_kind_mod.F90</em> in the obs_kind
     directory. This file must have the appropriate commented lines indicating
     where the different parts of the input special obs definition modules
     are to be inserted.  </TD></TR>
<TR><!--contents--><TD valign=top>output_obs_kind_mod_file           </TD>
    <!--  type  --><TD valign=top>character(len=129)<BR>
          <em class="unit">[default: 'null']</em></TD>
    <!--descript--><TD> Path name of output obs kind module to be
     created by the preprocessor. Normally this is 
    <em class="file">obs_kind_mod.F90</em> in the obs_kind
     directory.   </TD></TR>
<TR><!--contents--><TD valign=top>input_files           </TD>
    <!--  type  --><TD valign=top>character(len=129)<BR>
          <em class="unit">[default: 'null']</em></TD>
    <!--descript--><TD> A list of up to max_input_files file names that contain
     special format obs definition files that are to be incorporated into the
     preprocessed obs_kind_mod.f90 and obs_def_mod.f90. The files must be in the
     special obs definition format that includes commented F90 lines delimitting
     information about the observation type(s). These files normally reside in
     the obs_def directory in files such as 
      <em class="file">obs_def_reanalysis_bufr_mod.f90</em>.</TD></TR>
</TABLE>


<!--==================================================================-->
<!-- Describe the Files Used by this module.                          -->
<!--==================================================================-->

<A NAME="FilesUsed"></A>
<BR><HR><BR>
<H2>FILES</H2>
<UL><LI>input_obs_def_mod_file, specified by namelist; usually <em class="file">DEFAULT_obs_def_mod.F90</em>.
<LI>output_obs_def_mod_file, specified by namelist; usually <em class="file">obs_def_mod.f90</em>.
<LI>input_obs_kind_mod_file, specified by namelist; usually <em class="file">DEFAULT_obs_kind_mod.F90</em>.
<LI>output_obs_kind_mod_file, specified by namelist; usually <em class="file">obs_kind_mod.f90</em>.
    <LI>input_files, specified by namelist; usually files like <em class="file">obs_def_reanalysis_bufr_mod.f90</em>.
    <LI>namelistfile
</UL>

<!--==================================================================-->
<!-- Cite references, if need be.                                     -->
<!--==================================================================-->

<A NAME="References"></A>
<BR><HR><BR>
<H2>REFERENCES</H2>

<!--==================================================================-->
<!-- Describe all the error conditions and codes.                     -->
<!-- Putting a <BR> after the synopsis creates a nice effect.         -->
<!--==================================================================-->

<A NAME="Errors"></A>
<HR>
<H2>ERROR CODES and CONDITIONS</H2>
<div class="errors">
<TABLE border=1 cellspacing=1 cellpadding=10 width=100%>
<TR><TH>Routine</TH><TH>Message</TH><TH>Comment</TH></TR>

<TR><!-- routine --><TD VALIGN=top>preprocess</TD>
    <!-- message --><TD VALIGN=top>Namelist must provide input_obs_def_mod_file</TD>
    <!-- comment --><TD VALIGN=top>Need an input obs_def file to preprocess.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>preprocess</TD>
    <!-- message --><TD VALIGN=top>Namelist must provide input_obs_kind_mod_file</TD>
    <!-- comment --><TD VALIGN=top>Need an input obs_kind file to preprocess.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>preprocess</TD>
    <!-- message --><TD VALIGN=top>Namelist must provide output_obs_def_mod_file</TD>
    <!-- comment --><TD VALIGN=top>Need an output obs_def file to create.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>preprocess</TD>
    <!-- message --><TD VALIGN=top>Namelist must provide output_obs_kind_mod_file</TD>
    <!-- comment --><TD VALIGN=top>Need an output obs_kind file to create.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>preprocess</TD>
    <!-- message --><TD VALIGN=top>file ____ does not exist</TD>
    <!-- comment --><TD VALIGN=top>The input obs_def and obs_kind files must exist.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>preprocess</TD>
    <!-- message --><TD VALIGN=top>file ______ exists: Please Rename</TD>
    <!-- comment --><TD VALIGN=top>The output obs_kind and obs_def files must not
     exist. Want to avoid overwriting something important.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>preprocess</TD>
    <!-- message --><TD VALIGN=top>input_files _______ does NOT exist</TD>
    <!-- comment --><TD VALIGN=top>All of the specified special obs_def input modules
    must exist.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>preprocess</TD>
    <!-- message --><TD VALIGN=top>file _____ does NOT contain ! BEGIN DART PREPROCESS KIND LIST</TD>
    <!-- comment --><TD VALIGN=top>Each special obs_def input file must contain this comment string.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>preprocess</TD>
    <!-- message --><TD VALIGN=top>file _____ does NOT contain " END DART PREPROCESS KIND LIST</TD>
    <!-- comment --><TD VALIGN=top>Each special obs_def input file must contain this comment string.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>preprocess</TD>
    <!-- message --><TD VALIGN=top>Input DEFAULT obs_kind file ended unexpectedly.</TD>
    <!-- comment --><TD VALIGN=top>Did not find strings indicating where to insert special obs_def sections in the input obs_kind module.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>preprocess</TD>
    <!-- message --><TD VALIGN=top>Input DEFAULT obs_def file ended unexpectedly.</TD>
    <!-- comment --><TD VALIGN=top>Did not find strings indicating where to insert special obs_def sections in the input obs_def module.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>preprocess</TD>
    <!-- message --><TD VALIGN=top>file _____ does NOT contain ! BEGIN DART PREPROCESS.</TD>
    <!-- comment --><TD VALIGN=top>Input special obs_def file must contain this comment string.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>preprocess</TD>
    <!-- message --><TD VALIGN=top>file _____ does NOT contain ! END DART PREPROCESS.</TD>
    <!-- comment --><TD VALIGN=top>Input special obs_def file must contain this comment string.</TD>
</TR>

</TABLE>
</div>

<!--==================================================================-->
<!-- Describe the bugs.                                               -->
<!--==================================================================-->

<A NAME="KnownBugs"></A>
<BR><HR><BR>
<H2>KNOWN BUGS</H2>
<P>
</P>

<!--==================================================================-->
<!-- Descibe Future Plans.                                            -->
<!--==================================================================-->

<A NAME="FuturePlans"></A>
<BR><HR><BR>
<H2>FUTURE PLANS</H2>
<P>
</P>

<!--==================================================================-->
<!-- Have not fleshed out this part yet ... ha ha ha                  -->
<!--==================================================================-->

<!--==================================================================-->

<HR>
</BODY>
</HTML>
