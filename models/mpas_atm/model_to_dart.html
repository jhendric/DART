<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<HTML>
<HEAD>
<TITLE>program model_to_dart (MPAS ATM)</TITLE>
<link rel="stylesheet" type="text/css" href="../../doc/html/doc.css" />
</HEAD>
<BODY>
<A NAME="TOP"></A>

<H1>PROGRAM <em class=program>model_to_dart</em> for MPAS ATM</H1>

<table border=0 summary="" cellpadding=5>
<tr>
    <td valign=middle>
    <img src="../../doc/html/Dartboard7.png" alt="DART project logo" height=70 />
    </td>
    <td>
       <P>Jump to <a href="../../index.html">DART Documentation Main Index</a><br />
          <small><small>version information for this file: <br />
          <!-- version tag follows, do not edit -->
          $Id$</small></small>
       </P></td>
</tr>
</table>

<A HREF="#Namelist">NAMELIST</A> /
<A HREF="#Modules">MODULES</A> /
<A HREF="#FilesUsed">FILES</A> /
<A HREF="#References">REFERENCES</A> /
<A HREF="#Errors">ERRORS</A> /
<A HREF="#FuturePlans">PLANS</A> /
<A HREF="#Legalese">TERMS OF USE</A>

<H2>Overview</H2>

<P>
   <em class=program>model_to_dart</em> is the program that reads an MPAS ATM
   analysis file (nominally named <em class=file>mpas_restart.nc</em>) and 
   creates a DART output/restart file 
   (e.g. <em class=file>perfect_ics, filter_ics, ... </em>). The MPAS analysis
   files have a <strong>Time</strong> UNLIMITED Dimension, which indicates
   there may (at some point) be more than one timestep in the file. The DART
   routines are currently designed to use the LAST timestep. If the Time
   dimension of length 3, we use the third timestep. A warning message is
   issued and indicates exactly the time being used.
   <br />
   <br />
   <em class=file>input.nml</em><em class=code>&amp;mpas_vars_nml</em>
   defines the list of MPAS variables used to build the DART state vector.
   This namelist is more fully described in the 
   <a href="model_mod.html">MPAS model_mod.html</a> documentation. 
   For example:
</P>
   
<pre>&amp;mpas_vars_nml
   mpas_state_variables = 'uReconstructZonal',      'KIND_U_WIND_COMPONENT',
                          'uReconstructMeridional', 'KIND_V_WIND_COMPONENT',
                          'w',                      'KIND_VERTICAL_VELOCITY',
                          'theta',                  'KIND_POTENTIAL_TEMPERATURE',
                          'qv',                     'KIND_VAPOR_MIXING_RATIO',
                          'qc',                     'KIND_CLOUDWATER_MIXING_RATIO',
                          'qr',                     'KIND_RAINWATER_MIXING_RATIO',
                          'qi',                     'KIND_ICE_MIXING_RATIO',
                          'qs',                     'KIND_SNOW_MIXING_RATIO',
                          'qg',                     'KIND_GRAUPEL_MIXING_RATIO',
                          'surface_pressure',       'KIND_SURFACE_PRESSURE'
   /
</pre>  
 
<P>
   Conditions required for successful execution of <em class=program>model_to_dart</em> are:
</P>

<UL>
   <LI>a valid <em class=file>input.nml</em> namelist file for DART which contains</LI>
   <LI>a MPAS ATM analysis file (nominally named <em class=file>mpas_analysis.nc</em>).</LI>
</UL>

<P>
Since this program is called repeatedly for every ensemble member,
we have found it convenient to link the MPAS ATM analysis files
to a static input filename (e.g. <em class=file>mpas_analysis.nc</em>).
The default DART output filename is <em class=file>dart.ud</em> -
this may be moved or linked as necessary. The 'ud' extension is preferred
as this represents a model state that has been 'updated' by MPAS. The vast
majority of the time this routine is being called to convert a model state
that has been updated by MPAS for use by DART in a 'cycling' context.
There is no difference between these files and ones used to start a DART
experiment - an 'ics' file.
</P>

<!--==================================================================-->
<!--=================== DESCRIPTION OF A NAMELIST ====================-->
<!--==================================================================-->

<A NAME="Namelist"></A>
<hr />
<H2>NAMELIST</H2>
<P>We adhere to the F90 standard of starting a namelist with an ampersand
'&amp;' and terminating with a slash '/' for all our namelist input.
Character strings that contain a '/' must be
enclosed in quotes to prevent them from prematurely terminating the namelist.
The namelist declaration is:
</P>
<div class=namelist>
<pre>
<em class=call>namelist / model_to_dart_nml / </em> model_to_dart_output_file = 'dart.ud'
</pre>
</div>

<div class=indent1>
<!-- Description -->

<P>
This namelist is always read from a file called <em class=file>input.nml</em>.
</P>

<TABLE border=0 cellpadding=3 width=100%>
<TR><TH align=left>Contents    </TH>
    <TH align=left>Type        </TH>
    <TH align=left>Description </TH></TR>

<TR><!--contents--><TD valign=top>model_to_dart_output_file&nbsp;&nbsp;&nbsp;</TD>
    <!--  type  --><TD valign=top>character(len=128)&nbsp;&nbsp;&nbsp;</TD>
    <!--descript--><TD>The name of the DART file containing the model state
                       derived from the MPAS analysis file.
                       <em class=units>[default: 'dart.ud']</em></TD></TR>

</TABLE>

</div>
<br />

<P>Two more namelists need to be mentioned.
   The <a href="model_mod.html#Namelist">model_nml</a> namelist specifies the
   MPAS analysis file to be used as the source.
   The <a href="model_mod.html#mpas_vars_nml">mpas_vars_nml</a> namelist specifies the
   MPAS variables that will comprise the DART state vector. 
</P>

<!--==================================================================-->

<A NAME="Modules"></A>
<hr />
<H2>MODULES USED</H2>
<PRE>
assim_model_mod.f90
types_mod.f90
location_mod.f90
model_to_dart.f90
model_mod.f90
null_mpi_utilities_mod.f90
obs_kind_mod.f90
random_nr_mod.f90
random_seq_mod.f90
time_manager_mod.f90
utilities_mod.f90
</PRE>

<!--==================================================================-->
<!-- Describe the Files Used by this module.                          -->
<!--==================================================================-->

<A NAME="FilesUsed"></A>
<hr />
<H2>FILES Read</H2>
<UL><LI>MPAS analysis file; <em class=file>mpas_analysis.nc</em></LI>
    <LI>DART namelist file; <a href="work/input.nml">input.nml</a></LI>
</UL>

<H2>FILES Written</H2>
<UL><LI>DART initial conditions/restart file; e.g. <em class=file>dart.ud</em></LI>
</UL>

<!--==================================================================-->
<!-- Cite references, if need be.                                     -->
<!--==================================================================-->

<A NAME="References"></A>
<hr />
<H2>REFERENCES</H2>
<P>
none
</P>

<!--==================================================================-->
<!-- Describe all the error conditions and codes.                     -->
<!--==================================================================-->

<A NAME="Errors"></A>
<hr />
<H2>ERROR CODES and CONDITIONS</H2>
<P>
none - all error messages come from modules that have their own documentation.
</P>

<H2>KNOWN BUGS</H2>
<P>
none
</P>

<!--==================================================================-->
<!-- Describe Future Plans.                                           -->
<!--==================================================================-->

<A NAME="FuturePlans"></A>
<hr />
<H2>FUTURE PLANS</H2>
<P>
None.
</P>

<!--==================================================================-->
<!-- Legalese & Metadata                                              -->
<!--==================================================================-->

<A NAME="Legalese"></A>
<hr />
<H2>Terms of Use</H2>

<P>
DART software - Copyright 2004 - 2011 UCAR.<br />
This open source software is provided by UCAR, "as is",<br />
without charge, subject to all terms of use at<br />
<a href="http://www.image.ucar.edu/DAReS/DART/DART_download">
http://www.image.ucar.edu/DAReS/DART/DART_download</a>
</P>

<TABLE border=0 cellpadding=0 width=100% summary="">
<TR><TD valign=top>Contact:       </TD><TD> DART core group   </TD></TR>
<TR><TD valign=top>Revision:      </TD><TD> $Revision$ </TD></TR>
<TR><TD valign=top>Source:        </TD><TD> $URL$ </TD></TR>
<TR><TD valign=top>Change Date:   </TD><TD> $Date$ </TD></TR>
<TR><TD valign=top>Change&nbsp;history:&nbsp;</TD><TD> try "svn&nbsp;log" or "svn&nbsp;diff" </TD></TR>
</TABLE>

<!--==================================================================-->

</BODY>
</HTML>
