<!--
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!                                                                       !!
!!                   GNU General Public License                          !!
!!                                                                       !!
!! This file is part of the Data Assimilation Research Testbed (DART).   !!
!!                                                                       !!
!! DART is free software; you can redistribute it and/or modify          !!
!! it and are expected to follow the terms of the GNU General Public     !!
!! License as published by the Free Software Foundation.                 !!
!!                                                                       !!
!! DART is distributed in the hope that it will be useful,               !!
!! but WITHOUT ANY WARRANTY; without even the implied warranty of        !!
!! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         !!
!! GNU General Public License for more details.                          !!
!!                                                                       !!
!! You should have received a copy of the GNU General Public License     !!
!! along with DART; if not, write to:                                    !!
!!          Free Software Foundation, Inc.                               !!
!!          59 Temple Place, Suite 330                                   !!
!!          Boston, MA  02111-1307  USA                                  !!
!! or see:                                                               !!
!!          http://www.gnu.org/licenses/gpl.txt                          !!
!!                                                                       !!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-->

<HTML>
<TITLE>module model_mod</TITLE>
<link rel=stylesheet type=text/css href=../../doc/html/doc.css>
<BODY>

<DIV ALIGN=CENTER>
<A HREF="#Interface">INTERFACE</A> / 
<A HREF="#PublicEntities">PUBLIC COMPONENTS</A> / 
</DIV>

<!--==================================================================-->

<H1>MODULE model_mod</H1>
<A NAME="HEADER"></A>
<TABLE summary="">
   <TR><TD>Contact:       </TD><TD> Kevin Raeder                   </TD></TR>
   <TR><TD>Reviewers:     </TD><TD> &nbsp;                       </TD></TR>
   <TR><TD>Revision:      </TD><TD> $Revision$             </TD></TR>
   <TR><TD>Change Date:   </TD><TD> $Date$ </TD></TR>
   <TR><TD>Change history:</TD><TD> see CVS log                  </TD></TR>
</TABLE>

<!--==================================================================-->

<A NAME="OVERVIEW"></A>
<HR>
<H2>OVERVIEW</H2>

<P>
The description of the CAM finite volume (cam-fv) interface is the same as that of 
<A HREF="../cam/model_mod.html"> Eulerian</A>, except for the following.
<UL>
<LI> The FV model_mod.f90 has an internal parameter dycore_name, 
     which is used in tests to accomodate the staggered grid used for
     the US and VS fields.
</LI>
<LI> Interpolation of surface pressure has been added to this code,
     but not the Eulerian code, because surface pressure interpolation to the 
     staggered US and VS grid is required for ensuing vertical interpolations in pressure
     of those fields.   Public subroutine model_interpolate2 handles this.
</LI>
<LI> The state vector has been reorganized, so that US and VS are at the end, 
     instead of mixed in with the other variables.  This would affect the choice
     of indices when creating an obs_seq file containing identity obs.
</LI>
<LI> This model_mod is tailored for assimilating CO observations from MOPITT
     and has code to handle rain water and snow mixing ratios, as well as the
     standard field types; T, US, VS, Q, CLDLIQ, CLDICE, and PS.   Similar modifications
     will be necessary for any other fields to be added to the state vector for
     different assimilations.  See the Eulerian CAM documentation (link above)
     for details on this procedure.
</LI>
<LI> There is code for handling initial files in the format used prior to 3.0.3,
     but it has not been tested in the cam-fv model_mod.  It has been tested for
     Eulerian initial files in the cam model_mod.
</LI>
</UL>

<!--==================================================================-->
<!--Note to authors. The first row of the table is different.         -->

<A NAME="Interface"></A>
<HR>
<H2 class=indent2>PUBLIC INTERFACE</H2>

<TABLE>
<TR><TD><em class=call>use model_mod, only : </em></TD>
<TD><A HREF="#yyyroutine1">model_interpolate2</A></TD></TR>
</TABLE>


<!--==================================================================-->
<!-- Declare all public entities ...                                  -->
<!-- duplicate public routines template as many times as necessary    -->
<!-- make sure you replace all yyyroutine?? strings                   -->
<!--==================================================================-->

<A NAME="PublicEntities"></A>
<BR><HR><BR>
<H2 class=indent2>PUBLIC COMPONENTS</H2>
<P class=indent2>
The list of interfaces above is the complete public list for this module.
</P>


<!--=================== DESCRIPTION OF SUBROUTINE ====================-->

<A NAME="yyyroutine1"></A>
<P></P><HR><P></P>
<div class=routine>
<em class=call> call model_interpolate2(x, location, obs_type, interp_val, istatus)</em>
<pre>
real(r8), dimension(:),   intent(in)  :: <em class=code> x </em>
type(location_type),      intent(in)  :: <em class=code> location </em>
integer,                  intent(in)  :: <em class=code> obs_type </em>
real(r8),                 intent(out) :: <em class=code> interp_val </em>
integer,                  intent(out) :: <em class=code> istatus </em>
</pre></div>

<H3 class=indent1>Description</H3>

<P>
Given model state, returns the value of observation type interpolated to a given 
location by a method of the model's choosing. 
Currently only observation type KIND_SURFACE_PRESSURE is used.
If the interpolation is valid, istatus = 0. 
In the case where the observational operator is not
defined at the given location (e.g. the observation is below the lowest model level
or above the top level), interp_val is returned as 0.0 and istatus = 1. 
</P>

<TABLE width=100% border=0 summary="" cellpadding=3>

<TR><TD valign=top><em class=code>x &nbsp; &nbsp; </em></TD>
    <TD>Model state vector. </TD></TR>

<TR><TD valign=top><em class=code>location</em></TD>
    <TD>Location to which to interpolate.</TD></TR>

<TR><TD valign=top><em class=code>obs_type</em></TD>
    <TD>Integer indexing which type of observation is to be interpolated.</TD></TR>

<TR><TD valign=top><em class=code>interp_val</em></TD>
    <TD>Value interpolated to location.</TD></TR>

<TR><TD valign=top><em class=code>istatus</em></TD>
    <TD>Integer flag indicating the success of the interpolation.</TD></TR>

</TABLE>

<H3 class=indent1>Notes</H3>

<P>
</P>



<HR>
</BODY>
</HTML>
