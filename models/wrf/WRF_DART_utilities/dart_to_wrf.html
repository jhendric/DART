<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
          "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
<HEAD>
<TITLE>program dart_to_wrf</TITLE>
<link rel="stylesheet" type="text/css" href="../../../doc/html/doc.css">
</HEAD>
<BODY>
<A NAME="TOP"></A>

<center>
<A HREF="#Modules">MODULES</A> /
<A HREF="#Namelist">NAMELIST</A> /
<A HREF="#FilesUsed">FILES</A> /
<A HREF="#References">REFERENCES</A> /
<A HREF="#Errors">ERRORS</A> /
<A HREF="#FuturePlans">PLANS</A> /
<A HREF="#PrivateComponents">PRIVATE COMPONENTS</A> /
<A HREF="#Legalese">TERMS OF USE</A>
</center>

<H1>PROGRAM <em class=program>dart_to_wrf</em></H1>
<H1>PROGRAM <em class=program>wrf_to_dart</em></H1>
<!-- version tag follows, do not edit --><P>$Id$</P>

<P>
   Programs to convert WRF netCDF input files into DART format, and vice versa.
</P>

<!--==================================================================-->

<A NAME="Modules"></A>
<HR>
<H2>MODULES DIRECTLY USED</H2>
<PRE>
types_mod
time_manager_mod
utilities_mod
models/wrf/WRF_DART_utilities/wrf_data_module
assim_model_mod
</PRE>

<H2>MODULES INDIRECTLY USED</H2>
<PRE>
models/wrf/model_mod
models/wrf/module_map_utils
obs_kind_mod
location/threed_sphere/location_mod
random_seq_mod
random_nr_mod
</PRE>

<!--==================================================================-->
<!--=================== DESCRIPTION OF A NAMELIST  ===================-->
<!--==================================================================-->

<A NAME="Namelist"></A>
<HR>
<H2>NAMELIST</H2>
<P>We adhere to the F90 standard of starting a namelist with an ampersand
'&amp;' and terminating with a slash '/' for all our namelist input.
Consider yourself forewarned that character strings that contain a '/' must be
enclosed in quotes to prevent them from prematurely terminating the namelist.
The namelist declaration (i.e. what follows) has a different syntax, naturally.
</P>
<div class=namelist>
<pre>
<em class=call>namelist / dart_to_wrf_nml / </em> &amp;
    model_advance_file, dart_restart_name, adv_mod_command
    

<em class=call>namelist / model_nml / </em> 

</pre>
</div>

<div class=indent1>
<!-- Description -->

<P>The <em class=file>wrf_to_dart</em> program uses only the
WRF model namelist.  See the description in
the <a href="../model_mod.hmtl">WRF model_mod.html</a> file.
The <em class=file>dart_to_wrf</em> program uses the model namelist
plus an additional namelist: <em class=file>dart_to_wrf_nml</em>.
</P>

<P>Both namelists are read from a file 
called <em class=file>input.nml</em>
</P>

<TABLE border=0 cellpadding=3 width=100%>
<TR><TH align=left>Contents    </TH>
    <TH align=left>Type        </TH>
    <TH align=left>Description </TH></TR>
<TR><!--contents--><TD valign=top>model_advance_file  </TD>
    <!--  type  --><TD valign=top>logical             </TD>
    <!--descript--><TD>In normal usage set this to .TRUE. so the
     model_advance.csh script can function correctly.  The input
     file will have 2 timestamps: time for model to advance to, 
     and current time, plus the data.  However, to convert the
     file restart files after DART finishes running into wrfinput_d01
     files, for example to continue with a free run, set this to .FALSE.
     Default .TRUE. </TD></TR>
<TR><!--contents--><TD valign=top>dart_restart_name    </TD>
    <!--  type  --><TD valign=top>character(len=128)   </TD>
    <!--descript--><TD>In normal usage set this to 'dart_wrf_vector'
     so the model_advance.csh script can function correctly.  However,
     to write the output information directly to a netcdf file with
     a different name, set this to another value.
     Default 'dart_wrf_vector'. </TD></TR>
<TR><!--contents--><TD valign=top>adv_mod_command      </TD>
    <!--  type  --><TD valign=top>character(len=128)   </TD>
    <!--descript--><TD>In normal usage set this to './wrf.exe'
     so the model_advance.csh script can function correctly. 
     This information along with some time information is written
     to a file called 'wrf.info' if this is a model advance file.
     Default './wrf.exe'. This value used to be set in the
     wrf &amp;model_mod namelist, but has moved to here.</TD></TR>
</TABLE>


</div>
<br>

<!--==================================================================-->
<!-- Describe the Files Used by this module.                          -->
<!--==================================================================-->

<A NAME="FilesUsed"></A>
<HR>
<H2>FILES</H2>
<UL>
   <LI>input namelist : <em class=file>input.nml</em></LI>
   <LI>Input - output WRF state netCDF files : <em class=file>wrfinput_d01,
   wrfinput_d02, ...</em></LI>
   <LI>Input - output dart state vector format files : <em
   class=file>dart_wrf_vector</em></LI>
   <LI>Input - output: <em class=file>wrf.info</em></LI>
</UL>

<H3>File formats</H3>

<P>In the conversion from dart to WRF, the <em class=file>dart_wrf_vector</em>
file is usually one of the <em class=file>assim_model_state_ic#</em> that the
filter writes out to advance the ensemble. As input, the dart_wrf_vector
includes the target time in addition to the valid time at the beginning of the
file. As output, the dart_wrf_vector includes only the valid time at the
beginning of the file and is usually renamed as <em
class=file>assim_model_state_ud#</em> as input to the filter for the next
assimilation cycle.
</P>

<P>The file <em class=file>wrf.info</em> contains the target dart time, the valid
dart time, the valid date, the number of domains, and the command used to
executed the WRF model. The file <em class=file>wrf.info</em> is created in the
conversion from dart to WRF. In the conversion from WRF back to dart, the
target time is read from the file <em class=file>wrf.info</em>, which should
then be the valid time. This will be the time written to the dart vector
file. The rest of the information in the file <em class=file>wrf.info</em> is
only used by the program ensemble_init and by the script advance_model.csh.
</P>

<!--==================================================================-->
<!-- Cite references, if need be.                                     -->
<!--==================================================================-->

<A NAME="References"></A>
<HR>
<H2>REFERENCES</H2>
<ul>
<li> none </li>
</ul>

<!--==================================================================-->
<!-- Describe all the error conditions and codes.                     -->
<!--==================================================================-->

<A NAME="Errors"></A>
<HR>
<H2>ERROR CODES and CONDITIONS</H2>
<div class=errors>
<TABLE border=1 cellspacing=1 cellpadding=10 width=100%>
<TR><TH>Routine</TH><TH>Message</TH><TH>Comment</TH></TR>

<TR><!-- routine --><TD VALIGN=top>dart_open_and_alloc, transfer_dart_wrf</TD>
    <!-- message --><TD VALIGN=top>n_moist = is too large.</TD>
    <!-- comment --><TD VALIGN=top>The maximum number of moist variables is
    7. In order, they are [qv, qc, qr, qi, qs, qg, qnice]</TD></TR>

<TR><!-- routine --><TD VALIGN=top>transfer_dart_wrf</TD>
    <!-- message --><TD VALIGN=top>n_values differ in transfer</TD>
    <!-- comment --><TD VALIGN=top>If you get to this point, there would an
    inconsistency between subroutines dart_open_and_alloc and transfer_dart_wrf.</TD></TR>

<TR><!-- routine --><TD VALIGN=top>trans_2d</TD>
    <!-- message --><TD VALIGN=top>nx, ny, not compatible</TD>
    <!-- comment --><TD VALIGN=top>Dimensions nx, ny incompatible with incoming
    array a2d.</TD></TR>

<TR><!-- routine --><TD VALIGN=top>trans_3d</TD>
    <!-- message --><TD VALIGN=top>nx, ny, nz, not compatible</TD>
    <!-- comment --><TD VALIGN=top>Dimensions nx, ny, nz incompatible with incoming
    array a3d.</TD></TR>

</TABLE>
</div>

<H2>KNOWN BUGS</H2>
<P>
none
</P>

<!--==================================================================-->
<!-- Describe Future Plans.                                           -->
<!--==================================================================-->

<A NAME="FuturePlans"></A>
<HR>
<H2>FUTURE PLANS</H2>
<P>
This program has to be updated when new prognostic variables are included
in the state vector, e.g. when tracers or chemical species are evolved
in WRF. The program will also need to be updated to add parameters to be estimated.
</P>

<!--==================================================================-->
<!-- PrivateComponents                                                -->
<!--==================================================================-->

<A NAME="PrivateComponents"></A>
<HR>
<H2>PRIVATE COMPONENTS</H2>

<!--=================== DESCRIPTION OF SUBROUTINE ====================-->

<br>
<div class=routine>
<em class=call> call dart_open_and_alloc( wrf, dart, n_values, dart_unit,
dart_to_wrf, debug )</em>
<pre>
integer,          intent(out) :: <em class=code> dart_unit </em>
logical,          intent(in)  :: <em class=code> dart_to_wrf, debug </em>
type(wrf_dom),    intent(in)  :: <em class=code> wrf </em>
real(r8),         pointer     :: <em class=code> dart(:) </em>
integer,          intent(out) :: <em class=code> n_values  </em>
</pre>
</div>

<div class=indent1>
<!-- Description -->

<P>
Open a dart state vector file, determine the length of the dart
state vector, and allocate the dart state vector variable.
</P>

</div>
<br>

<!--=================== DESCRIPTION OF SUBROUTINE ====================-->

<br>
<div class=routine>
<em class=call> call transfer_dart_wrf ( dart_to_wrf, dart, wrf, n_values_in)</em>
<pre>
logical,          intent(in) :: <em class=code> dart_to_wrf </em>
type(wrf_dom),    intent(in) :: <em class=code> wrf </em>
real(r8), pointer            :: <em class=code> dart(:) </em>
integer,          intent(in) :: <em class=code> n_values_in </em>
</pre>
</div>

<div class=indent1>
<!-- Description -->

<P>
Transfer from dart state vector to a wrf structure, or vice versa.
</P>

</div>
<br>

<!--=================== DESCRIPTION OF SUBROUTINE ====================-->

<br>
<div class=routine>
<em class=call> call trans_2d( one_to_two, a1d, a2d, nx, ny )</em>
<pre>
integer,  intent(in) :: <em class=code> nx,ny </em>
real(r8), intent(in) :: <em class=code> a1d(:) </em>
real(r8), intent(in) :: <em class=code> a2d(nx,ny) </em>
logical,  intent(in) :: <em class=code> one_to_two </em>
</pre>
</div>

<div class=indent1>
<!-- Description -->

<P>
Transfer data from a 2D array into a 1D array, or vice versa.
</P>

</div>
<br>

<!--=================== DESCRIPTION OF SUBROUTINE ====================-->

<br>
<div class=routine>
<em class=call> call trans_3d( one_to_three, a1d, a3d, nx, ny, nz )</em>
<pre>
integer,  intent(in) :: <em class=code> nx,ny,nz </em>
real(r8), intent(in) :: <em class=code> a1d(:) </em>
real(r8), intent(in) :: <em class=code> a3d(:,:,:) </em>
logical,  intent(in) :: <em class=code> one_to_three </em>
</pre>
</div>

<div class=indent1>
<!-- Description -->

<P>
Transfer data from a 3D array into a 1D array, or vice versa.
</P>

</div>
<br>

<!--==================================================================-->
<!-- Legalese & Metadata                                              -->
<!--==================================================================-->

<A NAME="Legalese"></A>
<HR>
<H2>Terms of Use</H2>

<P>
DART software - Copyright &#169; 2004 - 2010 UCAR.<br>
This open source software is provided by UCAR, "as is",<br>
without charge, subject to all terms of use at<br>
<a href="http://www.image.ucar.edu/DAReS/DART/DART_download">
http://www.image.ucar.edu/DAReS/DART/DART_download</a>
</P>

<TABLE border=0 cellpadding=0 width=100% summary="">
<TR><TD valign=top>Contact:       </TD><TD> Hui Liu, David Dowell </TD></TR>
<TR><TD valign=top>Revision:      </TD><TD> $Revision$ </TD></TR>
<TR><TD valign=top>Source:        </TD><TD> $URL$ </TD></TR>
<TR><TD valign=top>Change Date:   </TD><TD> $Date$ </TD></TR>
<TR><TD valign=top>Change&nbsp;history:&nbsp;</TD><TD> try "svn&nbsp;log" or "svn&nbsp;diff" </TD></TR>
</TABLE>

<!--==================================================================-->

</BODY>
</HTML>
